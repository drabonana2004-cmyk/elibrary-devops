{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nlet AdminDashboardComponent = class AdminDashboardComponent {\n  constructor(apiService, authService, router, pdfService) {\n    this.apiService = apiService;\n    this.authService = authService;\n    this.router = router;\n    this.pdfService = pdfService;\n    this.activeTab = 'dashboard';\n    this.stats = null;\n    this.books = [];\n    this.filteredBooks = [];\n    this.categories = [];\n    this.borrows = [];\n    this.users = [];\n    this.overdueBorrows = [];\n    this.penaltyHistory = [];\n    this.registrationRequests = [];\n    this.auditLogs = [];\n    this.filteredLogs = [];\n    this.iotDevices = [];\n    this.shelves = [];\n    this.viewedNotifications = new Set();\n    this.alertDismissed = false;\n    this.showAddBookForm = false;\n    this.showAddCategoryForm = false;\n    this.newBook = {};\n    this.newCategory = {};\n    this.currentUser = this.authService.getCurrentUser();\n    // Filtres\n    this.bookSearch = '';\n    this.bookCategoryFilter = '';\n    this.bookAvailabilityFilter = '';\n    this.userSearch = '';\n    this.userRoleFilter = '';\n    this.userStatusFilter = '';\n    this.borrowView = 'current';\n    this.penaltyView = 'current';\n    this.selectedBooks = [];\n    this.logSearch = '';\n    this.logTypeFilter = '';\n    // Param√®tres\n    this.settings = {\n      default_borrow_days: 14,\n      penalty_per_day: 300,\n      mqtt_broker: 'localhost:1883',\n      rfid_topic: 'library/rfid'\n    };\n  }\n  ngOnInit() {\n    this.loadStats();\n    this.loadBooks();\n    this.loadCategories();\n    this.loadBorrows();\n    this.loadUsers();\n    this.loadOverdueBorrows();\n    this.loadRegistrationRequests();\n    this.loadAuditLogs();\n    this.loadIoTDevices();\n    this.loadShelves();\n    // √âcouter les mises √† jour de statut utilisateur\n    window.addEventListener('userStatusUpdated', event => {\n      this.currentUser = event.detail;\n    });\n    // V√©rifier p√©riodiquement les nouvelles demandes\n    setInterval(() => {\n      this.loadRegistrationRequests();\n    }, 30000);\n    // Initialiser les graphiques apr√®s le chargement\n    setTimeout(() => {\n      this.initCharts();\n    }, 1000);\n  }\n  initCharts() {\n    if (typeof document !== 'undefined') {\n      this.createBorrowsChart();\n      this.createCategoriesChart();\n      this.createUsersChart();\n      this.createTrendsChart();\n    }\n  }\n  createBorrowsChart() {\n    const canvas = document.getElementById('borrowsChart');\n    if (!canvas) return;\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    // Emprunts par mois (6 derniers mois)\n    const monthlyData = this.getMonthlyLoansData();\n    const maxValue = Math.max(...monthlyData.values, 1);\n    ctx.fillStyle = '#007bff';\n    ctx.font = '10px Arial';\n    for (let i = 0; i < monthlyData.values.length; i++) {\n      const barHeight = monthlyData.values[i] / maxValue * 150;\n      const x = i * 45 + 20;\n      const y = 180 - barHeight;\n      ctx.fillRect(x, y, 35, barHeight);\n      ctx.fillStyle = '#333';\n      ctx.fillText(monthlyData.labels[i], x, 195);\n      ctx.fillText(monthlyData.values[i].toString(), x + 10, y - 5);\n      ctx.fillStyle = '#007bff';\n    }\n  }\n  getMonthlyLoansData() {\n    const months = [];\n    const values = [];\n    const now = new Date();\n    for (let i = 5; i >= 0; i--) {\n      const date = new Date(now.getFullYear(), now.getMonth() - i, 1);\n      const monthName = date.toLocaleDateString('fr-FR', {\n        month: 'short'\n      });\n      months.push(monthName);\n      // Compter les emprunts de ce mois\n      const loansInMonth = this.borrows.filter(loan => {\n        const loanDate = new Date(loan.created_at || loan.loan_date);\n        return loanDate.getMonth() === date.getMonth() && loanDate.getFullYear() === date.getFullYear();\n      }).length;\n      values.push(loansInMonth);\n    }\n    return {\n      labels: months,\n      values\n    };\n  }\n  createCategoriesChart() {\n    const canvas = document.getElementById('categoriesChart');\n    if (!canvas) return;\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    if (this.categories.length === 0) {\n      ctx.fillStyle = '#666';\n      ctx.font = '14px Arial';\n      ctx.fillText('Aucune cat√©gorie', 100, 100);\n      return;\n    }\n    const colors = ['#007bff', '#28a745', '#ffc107', '#dc3545', '#6f42c1'];\n    const total = this.categories.length;\n    let currentAngle = 0;\n    const centerX = 150;\n    const centerY = 100;\n    const radius = 80;\n    for (let i = 0; i < this.categories.length; i++) {\n      const percentage = 1 / total * 100;\n      const sliceAngle = percentage / 100 * 2 * Math.PI;\n      ctx.beginPath();\n      ctx.moveTo(centerX, centerY);\n      ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);\n      ctx.closePath();\n      ctx.fillStyle = colors[i % colors.length];\n      ctx.fill();\n      // L√©gende\n      ctx.fillStyle = colors[i % colors.length];\n      ctx.fillRect(20, 20 + i * 20, 15, 15);\n      ctx.fillStyle = '#333';\n      ctx.font = '10px Arial';\n      ctx.fillText(`${this.categories[i].name}`, 40, 32 + i * 20);\n      currentAngle += sliceAngle;\n    }\n  }\n  createUsersChart() {\n    const canvas = document.getElementById('usersChart');\n    if (!canvas) return;\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    // Croissance des utilisateurs (6 derniers mois)\n    const userGrowthData = this.getUserGrowthData();\n    const maxValue = Math.max(...userGrowthData.values, 1);\n    ctx.strokeStyle = '#28a745';\n    ctx.lineWidth = 3;\n    ctx.beginPath();\n    for (let i = 0; i < userGrowthData.values.length; i++) {\n      const x = i * 50 + 30;\n      const y = 180 - userGrowthData.values[i] / maxValue * 150;\n      if (i === 0) {\n        ctx.moveTo(x, y);\n      } else {\n        ctx.lineTo(x, y);\n      }\n      // Points\n      ctx.fillStyle = '#28a745';\n      ctx.beginPath();\n      ctx.arc(x, y, 4, 0, 2 * Math.PI);\n      ctx.fill();\n      // Valeurs\n      ctx.fillStyle = '#333';\n      ctx.font = '10px Arial';\n      ctx.fillText(userGrowthData.values[i].toString(), x - 5, y - 10);\n    }\n    ctx.strokeStyle = '#28a745';\n    ctx.stroke();\n  }\n  getUserGrowthData() {\n    const months = [];\n    const values = [];\n    const now = new Date();\n    let cumulativeUsers = 0;\n    for (let i = 5; i >= 0; i--) {\n      const date = new Date(now.getFullYear(), now.getMonth() - i, 1);\n      const monthName = date.toLocaleDateString('fr-FR', {\n        month: 'short'\n      });\n      months.push(monthName);\n      // Compter les nouveaux utilisateurs de ce mois\n      const newUsersInMonth = this.users.filter(user => {\n        const userDate = new Date(user.created_at);\n        return userDate.getMonth() === date.getMonth() && userDate.getFullYear() === date.getFullYear();\n      }).length;\n      cumulativeUsers += newUsersInMonth;\n      values.push(cumulativeUsers);\n    }\n    return {\n      labels: months,\n      values\n    };\n  }\n  createTrendsChart() {\n    const canvas = document.getElementById('trendsChart');\n    if (!canvas) return;\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    // Tendances emprunts vs retours\n    const trendsData = this.getTrendsData();\n    const maxValue = Math.max(...trendsData.emprunts, ...trendsData.retours, 1);\n    // Ligne emprunts\n    ctx.strokeStyle = '#007bff';\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    for (let i = 0; i < trendsData.emprunts.length; i++) {\n      const x = i * 45 + 30;\n      const y = 180 - trendsData.emprunts[i] / maxValue * 150;\n      if (i === 0) ctx.moveTo(x, y);else ctx.lineTo(x, y);\n    }\n    ctx.stroke();\n    // Ligne retours\n    ctx.strokeStyle = '#28a745';\n    ctx.beginPath();\n    for (let i = 0; i < trendsData.retours.length; i++) {\n      const x = i * 45 + 30;\n      const y = 180 - trendsData.retours[i] / maxValue * 150;\n      if (i === 0) ctx.moveTo(x, y);else ctx.lineTo(x, y);\n    }\n    ctx.stroke();\n    // L√©gende\n    ctx.fillStyle = '#007bff';\n    ctx.fillRect(20, 20, 15, 3);\n    ctx.fillStyle = '#333';\n    ctx.font = '12px Arial';\n    ctx.fillText('Emprunts', 40, 30);\n    ctx.fillStyle = '#28a745';\n    ctx.fillRect(20, 35, 15, 3);\n    ctx.fillText('Retours', 40, 45);\n  }\n  getTrendsData() {\n    const emprunts = [];\n    const retours = [];\n    const now = new Date();\n    for (let i = 5; i >= 0; i--) {\n      const date = new Date(now.getFullYear(), now.getMonth() - i, 1);\n      // Emprunts du mois\n      const monthLoans = this.borrows.filter(loan => {\n        const loanDate = new Date(loan.created_at || loan.loan_date);\n        return loanDate.getMonth() === date.getMonth() && loanDate.getFullYear() === date.getFullYear();\n      }).length;\n      // Retours du mois\n      const monthReturns = this.borrows.filter(loan => {\n        const returnDate = new Date(loan.return_date || loan.updated_at);\n        return loan.status === 'returned' && returnDate.getMonth() === date.getMonth() && returnDate.getFullYear() === date.getFullYear();\n      }).length;\n      emprunts.push(monthLoans);\n      retours.push(monthReturns);\n    }\n    return {\n      emprunts,\n      retours\n    };\n  }\n  setActiveTab(tab) {\n    this.activeTab = tab;\n    if (tab === 'reports') {\n      setTimeout(() => this.initCharts(), 100);\n    }\n  }\n  refreshCharts() {\n    if (this.activeTab === 'reports') {\n      setTimeout(() => this.initCharts(), 100);\n    }\n  }\n  getTabTitle() {\n    const titles = {\n      'dashboard': 'Tableau de bord',\n      'users': 'Utilisateurs',\n      'borrows': 'Emprunts',\n      'books': 'Livres / Catalogue',\n      'inventory': 'Inventaire (IoT)',\n      'overdue': 'Retards & P√©nalit√©s',\n      'requests': 'Demandes / Inscriptions',\n      'reports': 'Statistiques & Rapports',\n      'settings': 'Configuration / Param√®tres',\n      'logs': 'Logs / Audit'\n    };\n    return titles[this.activeTab] || this.activeTab;\n  }\n  loadStats() {\n    this.apiService.getDashboardStats().subscribe({\n      next: data => {\n        this.stats = {\n          stats: {\n            total_books: data.stats?.total_books || 0,\n            total_users: data.stats?.total_users || 0,\n            active_borrows: data.stats?.active_loans || 0,\n            overdue_borrows: data.stats?.overdue_loans || 0\n          },\n          popular_books: data.popular_books || [],\n          recent_borrows: data.recent_loans || []\n        };\n      },\n      error: error => {\n        console.error('Erreur stats:', error);\n        this.stats = {\n          stats: {\n            total_books: 0,\n            total_users: 0,\n            active_borrows: 0,\n            overdue_borrows: 0\n          },\n          popular_books: [],\n          recent_borrows: []\n        };\n      }\n    });\n  }\n  loadBooks() {\n    // Charger les livres depuis localStorage\n    const storedBooks = localStorage.getItem('adminBooks');\n    if (storedBooks) {\n      this.books = JSON.parse(storedBooks);\n    } else {\n      this.books = [];\n    }\n    this.filteredBooks = this.books;\n  }\n  loadCategories() {\n    // Charger les cat√©gories depuis localStorage ou cr√©er des cat√©gories par d√©faut\n    const storedCategories = localStorage.getItem('categories');\n    if (storedCategories) {\n      this.categories = JSON.parse(storedCategories);\n    } else {\n      // Cr√©er des cat√©gories par d√©faut\n      this.categories = [{\n        id: 1,\n        name: 'Fiction',\n        description: 'Romans et nouvelles'\n      }, {\n        id: 2,\n        name: 'Science-Fiction',\n        description: 'Science-fiction et fantasy'\n      }, {\n        id: 3,\n        name: 'Histoire',\n        description: 'Livres d\\'histoire'\n      }, {\n        id: 4,\n        name: 'Philosophie',\n        description: 'Ouvrages philosophiques'\n      }, {\n        id: 5,\n        name: 'Informatique',\n        description: 'Livres techniques'\n      }, {\n        id: 6,\n        name: 'Romance',\n        description: 'Romans d\\'amour'\n      }, {\n        id: 7,\n        name: 'Thriller',\n        description: 'Suspense et thriller'\n      }, {\n        id: 8,\n        name: 'Biographie',\n        description: 'Biographies et autobiographies'\n      }, {\n        id: 9,\n        name: 'Jeunesse',\n        description: 'Livres pour enfants et adolescents'\n      }, {\n        id: 10,\n        name: 'Essais',\n        description: 'Essais et analyses'\n      }];\n      localStorage.setItem('categories', JSON.stringify(this.categories));\n    }\n  }\n  loadBorrows() {\n    // Charger les emprunts depuis localStorage\n    const borrowRequests = JSON.parse(localStorage.getItem('borrowRequests') || '[]');\n    const localBorrows = JSON.parse(localStorage.getItem('borrows') || '[]');\n    // Combiner tous les emprunts\n    this.borrows = [...localBorrows, ...borrowRequests];\n    // Fallback API si pas de donn√©es locales\n    if (this.borrows.length === 0) {\n      this.apiService.getAllBorrows().subscribe({\n        next: data => this.borrows = data || [],\n        error: error => console.error('Erreur emprunts:', error)\n      });\n    }\n  }\n  onBookCoverSelect(event) {\n    const file = event.target.files[0];\n    if (file) {\n      this.newBook.cover_file = file;\n      this.newBook.cover_preview = URL.createObjectURL(file);\n    }\n  }\n  addBook() {\n    if (this.newBook.title && this.newBook.author && this.newBook.isbn && this.newBook.category_id && this.newBook.stock) {\n      const categoryName = this.categories.find(c => c.id == this.newBook.category_id)?.name || 'Fiction';\n      const newBookData = {\n        id: Date.now(),\n        title: this.newBook.title,\n        author: this.newBook.author,\n        isbn: this.newBook.isbn,\n        category_id: this.newBook.category_id,\n        category: {\n          name: categoryName\n        },\n        stock: this.newBook.stock,\n        available: this.newBook.stock,\n        description: this.newBook.description || 'Aucune description disponible.',\n        cover_url: this.newBook.cover_preview || this.getDefaultBookImage(categoryName),\n        times_borrowed: 0,\n        created_at: new Date()\n      };\n      this.books.push(newBookData);\n      this.filteredBooks = [...this.books];\n      // Sauvegarder dans localStorage pour que les utilisateurs puissent voir les livres\n      localStorage.setItem('adminBooks', JSON.stringify(this.books));\n      // Mettre √† jour les logs et graphiques\n      this.loadAuditLogs();\n      this.refreshCharts();\n      alert('Livre ajout√© avec succ√®s!');\n      this.cancelAddBook();\n    } else {\n      alert('Veuillez remplir tous les champs obligatoires');\n    }\n  }\n  getDefaultBookImage(categoryName) {\n    const images = {\n      'Fiction': 'https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?w=300&h=400&fit=crop',\n      'Science-Fiction': 'https://images.unsplash.com/photo-1589998059171-988d887df646?w=300&h=400&fit=crop',\n      'Histoire': 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=300&h=400&fit=crop',\n      'Philosophie': 'https://images.unsplash.com/photo-1481627834876-b7833e8f5570?w=300&h=400&fit=crop',\n      'Informatique': 'https://images.unsplash.com/photo-1516979187457-637abb4f9353?w=300&h=400&fit=crop',\n      'Romance': 'https://images.unsplash.com/photo-1474552226712-ac0f0961a954?w=300&h=400&fit=crop',\n      'Thriller': 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=300&h=400&fit=crop',\n      'Biographie': 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=300&h=400&fit=crop',\n      'Jeunesse': 'https://images.unsplash.com/photo-1513475382585-d06e58bcb0e0?w=300&h=400&fit=crop',\n      'Essais': 'https://images.unsplash.com/photo-1481627834876-b7833e8f5570?w=300&h=400&fit=crop'\n    };\n    return images[categoryName] || 'https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?w=300&h=400&fit=crop';\n  }\n  cancelAddBook() {\n    this.showAddBookForm = false;\n    this.showAddCategoryForm = false;\n    this.newBook = {};\n    this.newCategory = {};\n  }\n  addNewCategory() {\n    if (this.newCategory.name) {\n      const newCategoryData = {\n        id: Date.now(),\n        name: this.newCategory.name,\n        description: this.newCategory.description,\n        created_at: new Date()\n      };\n      this.categories.push(newCategoryData);\n      // Sauvegarder dans localStorage\n      localStorage.setItem('categories', JSON.stringify(this.categories));\n      this.newBook.category_id = newCategoryData.id;\n      this.showAddCategoryForm = false;\n      this.newCategory = {};\n      // Mettre √† jour les graphiques\n      this.refreshCharts();\n      alert('Cat√©gorie ajout√©e avec succ√®s!');\n    }\n  }\n  returnBook(borrowId) {\n    if (confirm('Marquer ce livre comme retourn√© ?')) {\n      // Mettre √† jour dans localStorage\n      const borrowRequests = JSON.parse(localStorage.getItem('borrowRequests') || '[]');\n      const localBorrows = JSON.parse(localStorage.getItem('borrows') || '[]');\n      // Chercher dans les demandes d'emprunt\n      const requestIndex = borrowRequests.findIndex(req => req.id === borrowId);\n      if (requestIndex !== -1) {\n        borrowRequests[requestIndex].status = 'returned';\n        borrowRequests[requestIndex].return_date = new Date().toISOString();\n        localStorage.setItem('borrowRequests', JSON.stringify(borrowRequests));\n      }\n      // Chercher dans les emprunts locaux\n      const borrowIndex = localBorrows.findIndex(borrow => borrow.id === borrowId);\n      if (borrowIndex !== -1) {\n        localBorrows[borrowIndex].status = 'returned';\n        localBorrows[borrowIndex].return_date = new Date().toISOString();\n        localStorage.setItem('borrows', JSON.stringify(localBorrows));\n      }\n      // Recharger les donn√©es\n      this.loadBorrows();\n      this.loadStats();\n      alert('Livre marqu√© comme retourn√© avec succ√®s!');\n      // Fallback API\n      this.apiService.returnBook(borrowId).subscribe({\n        next: () => console.log('Retour synchronis√© avec API'),\n        error: error => console.error('Erreur sync API:', error)\n      });\n    }\n  }\n  getStatusLabel(status) {\n    const labels = {\n      'active': 'Actif',\n      'approved': 'Certifi√©',\n      'pending': 'En attente',\n      'suspended': 'Suspendu',\n      'returned': 'Retourn√©',\n      'overdue': 'En Retard',\n      'rejected': 'Rejet√©'\n    };\n    return labels[status] || status;\n  }\n  loadUsers() {\n    // Charger les utilisateurs certifi√©s depuis localStorage\n    const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');\n    // Filtrer seulement les utilisateurs certifi√©s (approved)\n    this.users = registeredUsers.filter(user => user.status === 'approved');\n    // Fallback API si pas de donn√©es locales\n    if (this.users.length === 0) {\n      this.apiService.getUsers().subscribe({\n        next: data => this.users = data || [],\n        error: error => {\n          console.error('Erreur utilisateurs:', error);\n          this.users = [];\n        }\n      });\n    }\n  }\n  loadOverdueBorrows() {\n    this.apiService.getOverdueLoans().subscribe({\n      next: data => this.overdueBorrows = data || [],\n      error: error => {\n        console.error('Erreur retards:', error);\n        this.overdueBorrows = [];\n      }\n    });\n  }\n  loadRegistrationRequests() {\n    const storedRequests = JSON.parse(localStorage.getItem('registrationRequests') || '[]');\n    this.registrationRequests = storedRequests;\n  }\n  loadAuditLogs() {\n    // G√©n√©rer des logs bas√©s sur les vraies activit√©s\n    this.auditLogs = [];\n    // Logs pour chaque livre ajout√©\n    this.books.forEach(book => {\n      this.auditLogs.push({\n        created_at: book.created_at || new Date(),\n        type: 'admin',\n        user_name: 'Admin',\n        action: 'Ajout livre',\n        details: `Livre ajout√©: ${book.title} par ${book.author}`\n      });\n    });\n    // Logs pour chaque utilisateur\n    this.users.forEach(user => {\n      this.auditLogs.push({\n        created_at: user.created_at || new Date(),\n        type: 'system',\n        user_name: 'Syst√®me',\n        action: 'Inscription utilisateur',\n        details: `Nouvel utilisateur: ${user.name} (${user.email})`\n      });\n    });\n    // Logs pour chaque emprunt\n    this.borrows.forEach(borrow => {\n      this.auditLogs.push({\n        created_at: borrow.created_at || new Date(),\n        type: 'user',\n        user_name: borrow.user_name || 'Utilisateur',\n        action: 'Emprunt livre',\n        details: `Emprunt: ${borrow.book_title || 'Livre'}`\n      });\n    });\n    // Trier par date d√©croissante\n    this.auditLogs.sort((a, b) => new Date(b.created_at).getTime() - new Date(a.created_at).getTime());\n    // Initialiser les logs filtr√©s\n    this.filteredLogs = [...this.auditLogs];\n  }\n  loadIoTDevices() {\n    this.iotDevices = [];\n  }\n  loadShelves() {\n    this.shelves = [];\n  }\n  sendReminder(userId) {\n    this.apiService.sendReminder(userId).subscribe({\n      next: () => {\n        alert('Rappel envoy√© avec succ√®s!');\n      },\n      error: error => console.error('Erreur rappel:', error)\n    });\n  }\n  // M√©thodes pour les livres\n  searchBooks() {\n    this.filterBooks();\n  }\n  filterBooks() {\n    this.filteredBooks = this.books.filter(book => {\n      const matchesSearch = !this.bookSearch || book.title.toLowerCase().includes(this.bookSearch.toLowerCase()) || book.author.toLowerCase().includes(this.bookSearch.toLowerCase()) || book.isbn.includes(this.bookSearch);\n      const matchesCategory = !this.bookCategoryFilter || book.category_id == this.bookCategoryFilter;\n      const matchesAvailability = !this.bookAvailabilityFilter || this.bookAvailabilityFilter === '1' && book.stock > 0 || this.bookAvailabilityFilter === '0' && book.stock <= 0;\n      return matchesSearch && matchesCategory && matchesAvailability;\n    });\n  }\n  selectAllBooks(event) {\n    if (event.target.checked) {\n      this.selectedBooks = this.filteredBooks.map(book => book.id);\n    } else {\n      this.selectedBooks = [];\n    }\n  }\n  toggleBookSelection(bookId, event) {\n    if (event.target.checked) {\n      this.selectedBooks.push(bookId);\n    } else {\n      this.selectedBooks = this.selectedBooks.filter(id => id !== bookId);\n    }\n  }\n  viewBook(book) {\n    const description = book.description || 'Aucune description disponible.';\n    alert(`üìö D√âTAILS DU LIVRE\\n\\nüìñ Titre: ${book.title}\\n‚úçÔ∏è Auteur: ${book.author}\\nüè∑Ô∏è ISBN: ${book.isbn}\\nüìÇ Cat√©gorie: ${book.category?.name || 'Non d√©finie'}\\nüì¶ Stock: ${book.available || 0}/${book.stock}\\nüìä Emprunts: ${book.times_borrowed || 0}\\n\\nüìù DESCRIPTION:\\n${description}`);\n  }\n  editBook(book) {\n    const newTitle = prompt('Nouveau titre:', book.title);\n    if (newTitle && newTitle !== book.title) {\n      book.title = newTitle;\n      alert('Livre modifi√© avec succ√®s!');\n    }\n  }\n  assignTag(book) {\n    const tagUid = prompt('Entrez l\\'UID du tag RFID:', book.tag_uid || '');\n    if (tagUid) {\n      book.tag_uid = tagUid;\n      alert('Tag assign√© avec succ√®s!');\n    }\n  }\n  confirmDeleteBook(book) {\n    if (confirm(`Supprimer \"${book.title}\" ?\\nCette action est irr√©versible.`)) {\n      this.books = this.books.filter(b => b.id !== book.id);\n      this.filteredBooks = this.filteredBooks.filter(b => b.id !== book.id);\n      alert('Livre supprim√© avec succ√®s!');\n    }\n  }\n  exportBooks() {\n    const csvContent = 'Titre,Auteur,ISBN,Cat√©gorie,Stock\\n' + this.filteredBooks.map(book => `\"${book.title}\",\"${book.author}\",\"${book.isbn}\",\"${book.category?.name || ''}\",\"${book.stock}\"`).join('\\n');\n    const blob = new Blob([csvContent], {\n      type: 'text/csv'\n    });\n    const url = window.URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = 'livres_export.csv';\n    a.click();\n    window.URL.revokeObjectURL(url);\n    alert('Export CSV t√©l√©charg√© avec succ√®s!');\n  }\n  // M√©thodes IoT\n  startInventoryScan() {\n    if (this.iotDevices.length === 0) {\n      alert('‚ùå Aucun dispositif IoT connect√©\\n\\nPour utiliser cette fonctionnalit√©:\\n1. Achetez un Raspberry Pi (50‚Ç¨)\\n2. Connectez un lecteur RFID\\n3. Installez le script Python\\n4. Collez des puces RFID sur vos livres');\n      return;\n    }\n    alert('üîÑ Scan d\\'inventaire d√©marr√©...\\n\\nRecherche des tags RFID en cours...');\n    setTimeout(() => {\n      const scannedBooks = this.books.length; // Utiliser le vrai nombre de livres\n      alert(`‚úÖ Scan termin√©!\\n\\nüìö ${scannedBooks} livres d√©tect√©s\\nüìç Localisation mise √† jour`);\n      this.shelves = [{\n        name: 'Rayon A1',\n        detected_books: Math.floor(scannedBooks / 2)\n      }, {\n        name: 'Rayon A2',\n        detected_books: Math.ceil(scannedBooks / 2)\n      }];\n    }, 2000);\n  }\n  simulateIoTSetup() {\n    if (confirm('ü§ñ Simuler l\\'installation IoT?\\n\\nCela va cr√©er des dispositifs virtuels pour tester.')) {\n      this.iotDevices = [{\n        name: 'Raspberry Pi Virtuel',\n        type: 'RFID Reader',\n        status: 'online'\n      }, {\n        name: 'Kiosk Simulation',\n        type: 'Self-service',\n        status: 'online'\n      }];\n      alert('‚úÖ Dispositifs IoT virtuels cr√©√©s!\\n\\nVous pouvez maintenant tester le scan d\\'inventaire.');\n    }\n  }\n  // M√©thodes rapports\n  exportReport(type) {\n    const reports = {\n      'top-books': 'Top 10 des Livres les Plus Emprunt√©s',\n      'monthly-activity': 'Rapport d\\'Activit√© Mensuelle',\n      'active-users': 'Liste des Utilisateurs Actifs',\n      'iot-stats': 'Statistiques des Dispositifs IoT'\n    };\n    const htmlContent = this.generateSpecializedPDF(type, reports[type]);\n    const filename = `eLibrary_${type}_${new Date().toISOString().split('T')[0]}.pdf`;\n    this.pdfService.generatePDF(htmlContent, filename);\n    alert(`üìÑ Rapport PDF pr√™t!\\n\\nCliquez sur \"T√©l√©charger PDF\" dans la nouvelle fen√™tre\\nou utilisez Ctrl+P pour enregistrer.`);\n  }\n  generateSpecializedPDF(type, title) {\n    const date = new Date().toLocaleDateString('fr-FR');\n    const time = new Date().toLocaleTimeString('fr-FR');\n    const reportTitles = {\n      'top-books': 'Top 10 des Livres les Plus Emprunt√©s',\n      'monthly-activity': 'Rapport d\\'Activit√© Mensuelle',\n      'active-users': 'Liste des Utilisateurs Actifs',\n      'iot-stats': 'Statistiques des Dispositifs IoT'\n    };\n    const reportContent = this.getReportContent(type);\n    return `\n<div style=\"font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px;\">\n    <div style=\"text-align: center; background: linear-gradient(135deg, #007bff, #0056b3); color: white; padding: 30px; border-radius: 10px; margin-bottom: 30px;\">\n        <div style=\"font-size: 48px; margin-bottom: 10px;\">üìö</div>\n        <div style=\"font-size: 28px; font-weight: bold; margin-bottom: 10px;\">eLibrary</div>\n        <div style=\"font-size: 18px; opacity: 0.9;\">${reportTitles[type]}</div>\n        <div style=\"font-size: 14px; margin-top: 15px; opacity: 0.8;\">G√©n√©r√© le ${date} √† ${time}</div>\n    </div>\n    \n    <div style=\"background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);\">\n        ${reportContent}\n    </div>\n    \n    <div style=\"text-align: center; margin-top: 40px; padding: 20px; color: #6c757d; border-top: 1px solid #dee2e6;\">\n        <p><strong>eLibrary</strong> - Syst√®me de Gestion de Biblioth√®que</p>\n        <p>Rapport confidentiel g√©n√©r√© automatiquement</p>\n    </div>\n</div>`;\n  }\n  getReportContent(type) {\n    const totalBooks = this.books.length;\n    const totalUsers = this.users.length;\n    const totalLoans = this.borrows.length;\n    switch (type) {\n      case 'top-books':\n        const booksWithLoans = this.books.map(book => ({\n          ...book,\n          loan_count: this.borrows.filter(loan => loan.book_id === book.id).length\n        })).sort((a, b) => b.loan_count - a.loan_count).slice(0, 5);\n        let booksTable = '';\n        if (booksWithLoans.length === 0) {\n          booksTable = '<tr><td colspan=\"6\" style=\"padding: 12px; border-bottom: 1px solid #dee2e6; text-align: center;\">Aucun livre avec emprunts</td></tr>';\n        } else {\n          booksTable = booksWithLoans.map((book, index) => `<tr style=\"${index % 2 === 0 ? 'background: #f8f9fa;' : ''}\"><td style=\"padding: 12px; border-bottom: 1px solid #dee2e6;\">${index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : ''} ${index + 1}</td><td style=\"padding: 12px; border-bottom: 1px solid #dee2e6;\">${book.title}</td><td style=\"padding: 12px; border-bottom: 1px solid #dee2e6;\">${book.author}</td><td style=\"padding: 12px; border-bottom: 1px solid #dee2e6;\">${book.category?.name || 'N/A'}</td><td style=\"padding: 12px; border-bottom: 1px solid #dee2e6;\">${book.loan_count}</td><td style=\"padding: 12px; border-bottom: 1px solid #dee2e6;\">${totalLoans > 0 ? Math.round(book.loan_count / totalLoans * 100) : 0}%</td></tr>`).join('');\n        }\n        return `\n        <div style=\"background: #fff3cd; padding: 15px; border-radius: 5px; border-left: 4px solid #ffc107; margin: 20px 0;\">\n            <strong>üìä Analyse des Emprunts</strong><br>\n            Ce rapport pr√©sente les livres les plus populaires bas√© sur les vraies donn√©es.\n        </div>\n        <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0;\">\n            <div style=\"background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center; border-left: 4px solid #007bff;\">\n                <div style=\"font-size: 32px; font-weight: bold; color: #007bff;\">${totalLoans}</div>\n                <div style=\"color: #6c757d; font-size: 14px;\">Total Emprunts</div>\n            </div>\n            <div style=\"background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center; border-left: 4px solid #007bff;\">\n                <div style=\"font-size: 32px; font-weight: bold; color: #007bff;\">${totalBooks}</div>\n                <div style=\"color: #6c757d; font-size: 14px;\">Livres Diff√©rents</div>\n            </div>\n            <div style=\"background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center; border-left: 4px solid #007bff;\">\n                <div style=\"font-size: 32px; font-weight: bold; color: #007bff;\">${totalBooks > 0 ? (totalLoans / totalBooks).toFixed(1) : 0}</div>\n                <div style=\"color: #6c757d; font-size: 14px;\">Emprunts/Livre</div>\n            </div>\n        </div>\n        <table style=\"width: 100%; border-collapse: collapse; margin: 20px 0;\">\n            <tr><th style=\"background: #007bff; color: white; padding: 12px; text-align: left;\">Rang</th><th style=\"background: #007bff; color: white; padding: 12px; text-align: left;\">Titre</th><th style=\"background: #007bff; color: white; padding: 12px; text-align: left;\">Auteur</th><th style=\"background: #007bff; color: white; padding: 12px; text-align: left;\">Cat√©gorie</th><th style=\"background: #007bff; color: white; padding: 12px; text-align: left;\">Emprunts</th><th style=\"background: #007bff; color: white; padding: 12px; text-align: left;\">Taux</th></tr>\n            ${booksTable}\n        </table>`;\n      case 'monthly-activity':\n        const activeLoans = this.borrows.filter(loan => loan.status === 'active').length;\n        const returnedLoans = this.borrows.filter(loan => loan.status === 'returned').length;\n        const overdueLoans = this.overdueBorrows.length;\n        return `\n        <div class=\"highlight\">\n            <strong>üìà Activit√© R√©elle</strong><br>\n            R√©sum√© de l'activit√© actuelle de la biblioth√®que bas√© sur les vraies donn√©es.\n        </div>\n        <div class=\"stats-grid\">\n            <div class=\"stat-card\">\n                <div class=\"stat-number\">${activeLoans}</div>\n                <div class=\"stat-label\">Emprunts Actifs</div>\n            </div>\n            <div class=\"stat-card\">\n                <div class=\"stat-number\">${returnedLoans}</div>\n                <div class=\"stat-label\">Retours</div>\n            </div>\n            <div class=\"stat-card\">\n                <div class=\"stat-number\">${totalUsers}</div>\n                <div class=\"stat-label\">Utilisateurs</div>\n            </div>\n            <div class=\"stat-card\">\n                <div class=\"stat-number\">${totalBooks}</div>\n                <div class=\"stat-label\">Livres Total</div>\n            </div>\n        </div>\n        <h3>üìä √âtat Actuel</h3>\n        <table>\n            <tr><th>Indicateur</th><th>Valeur</th><th>Statut</th></tr>\n            <tr><td>Emprunts actifs</td><td>${activeLoans}</td><td>${activeLoans > 0 ? 'üü¢ Actif' : 'üî¥ Aucun'}</td></tr>\n            <tr><td>Livres disponibles</td><td>${totalBooks}</td><td>${totalBooks > 0 ? 'üü¢ Disponible' : 'üî¥ Vide'}</td></tr>\n            <tr><td>Utilisateurs inscrits</td><td>${totalUsers}</td><td>${totalUsers > 0 ? 'üü¢ Actif' : 'üî¥ Aucun'}</td></tr>\n            <tr><td>Retards</td><td>${overdueLoans}</td><td>${overdueLoans === 0 ? 'üü¢ Aucun' : 'üü° Attention'}</td></tr>\n        </table>`;\n      case 'active-users':\n        const usersWithLoans = this.users.map(user => ({\n          ...user,\n          active_loans: this.borrows.filter(loan => loan.user_id === user.id && loan.status === 'active').length,\n          total_loans: this.borrows.filter(loan => loan.user_id === user.id).length\n        }));\n        let usersTable = '';\n        if (usersWithLoans.length === 0) {\n          usersTable = '<tr><td colspan=\"6\" class=\"text-center\">Aucun utilisateur enregistr√©</td></tr>';\n        } else {\n          usersTable = usersWithLoans.map(user => `<tr><td>${user.name}</td><td>${user.email}</td><td>${user.active_loans}</td><td>${user.total_loans}</td><td>${new Date(user.created_at).toLocaleDateString()}</td><td>${user.status === 'active' ? '‚úÖ Actif' : '‚ùå Inactif'}</td></tr>`).join('');\n        }\n        return `\n        <div class=\"highlight\">\n            <strong>üë• Utilisateurs Actifs</strong><br>\n            Liste r√©elle des utilisateurs de la biblioth√®que.\n        </div>\n        <div class=\"stats-grid\">\n            <div class=\"stat-card\">\n                <div class=\"stat-number\">${totalUsers}</div>\n                <div class=\"stat-label\">Utilisateurs Total</div>\n            </div>\n            <div class=\"stat-card\">\n                <div class=\"stat-number\">${totalUsers > 0 ? (totalLoans / totalUsers).toFixed(1) : 0}</div>\n                <div class=\"stat-label\">Emprunts/Utilisateur</div>\n            </div>\n            <div class=\"stat-card\">  \n                <div class=\"stat-number\">${totalLoans > 0 ? Math.round(this.borrows.filter(l => l.status === 'returned').length / totalLoans * 100) : 0}%</div>\n                <div class=\"stat-label\">Taux de Retour</div>\n            </div>\n        </div>\n        <table>\n            <tr><th>Nom</th><th>Email</th><th>Emprunts Actifs</th><th>Total Emprunts</th><th>Inscription</th><th>Statut</th></tr>\n            ${usersTable}\n        </table>`;\n      case 'iot-stats':\n        return `\n        <div class=\"highlight\">\n            <strong>üîå Statistiques IoT</strong><br>\n            √âtat et performance des dispositifs IoT connect√©s √† la biblioth√®que.\n        </div>\n        <div class=\"stats-grid\">\n            <div class=\"stat-card\">\n                <div class=\"stat-number\">2</div>\n                <div class=\"stat-label\">Dispositifs Connect√©s</div>\n            </div>\n            <div class=\"stat-card\">\n                <div class=\"stat-number\">98%</div>\n                <div class=\"stat-label\">Uptime Moyen</div>\n            </div>\n            <div class=\"stat-card\">\n                <div class=\"stat-number\">156</div>\n                <div class=\"stat-label\">Scans RFID</div>\n            </div>\n        </div>\n        <h3>üì° √âtat des Dispositifs</h3>\n        <table>\n            <tr><th>Dispositif</th><th>Type</th><th>Statut</th><th>Uptime</th><th>Derni√®re Activit√©</th></tr>\n            <tr><td>üî¥ Raspberry Pi 1</td><td>Lecteur RFID</td><td>‚ùå Hors ligne</td><td>0%</td><td>Non configur√©</td></tr>\n            <tr><td>üî¥ Kiosk Terminal</td><td>Self-service</td><td>‚ùå Hors ligne</td><td>0%</td><td>Non configur√©</td></tr>\n        </table>\n        <div class=\"highlight\">\n            <strong>‚ö†Ô∏è Configuration Requise</strong><br>\n            Les dispositifs IoT ne sont pas encore configur√©s. Consultez la documentation pour l'installation.\n        </div>`;\n      default:\n        return '<p>Type de rapport non support√©.</p>';\n    }\n  }\n  // M√©thodes logs\n  getLogTypeClass(type) {\n    const classes = {\n      'admin': 'bg-primary',\n      'user': 'bg-success',\n      'system': 'bg-secondary',\n      'error': 'bg-danger'\n    };\n    return classes[type] || 'bg-secondary';\n  }\n  filterLogs() {\n    this.filteredLogs = this.auditLogs.filter(log => {\n      const matchesSearch = !this.logSearch || log.action.toLowerCase().includes(this.logSearch.toLowerCase()) || log.details.toLowerCase().includes(this.logSearch.toLowerCase()) || log.user_name.toLowerCase().includes(this.logSearch.toLowerCase());\n      const matchesType = !this.logTypeFilter || log.type === this.logTypeFilter;\n      return matchesSearch && matchesType;\n    });\n  }\n  exportLogs() {\n    const csvContent = 'Date,Type,Utilisateur,Action,Details\\n' + this.filteredLogs.map(log => `\"${new Date(log.created_at).toLocaleString()}\",\"${log.type}\",\"${log.user_name}\",\"${log.action}\",\"${log.details}\"`).join('\\n');\n    const blob = new Blob([csvContent], {\n      type: 'text/csv;charset=utf-8'\n    });\n    const url = window.URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `eLibrary_logs_${new Date().toISOString().split('T')[0]}.csv`;\n    a.click();\n    window.URL.revokeObjectURL(url);\n    alert('Export des logs t√©l√©charg√© avec succ√®s!');\n  }\n  // M√©thodes de sauvegarde\n  saveSystemSettings() {\n    if (this.settings.default_borrow_days < 1 || this.settings.penalty_per_day < 0) {\n      alert('Veuillez entrer des valeurs valides!');\n      return;\n    }\n    // Simuler la sauvegarde\n    setTimeout(() => {\n      alert(`‚úì Param√®tres syst√®me sauvegard√©s avec succ√®s!\\n\\n‚Ä¢ Dur√©e d'emprunt: ${this.settings.default_borrow_days} jours\\n‚Ä¢ P√©nalit√©: ${this.settings.penalty_per_day} CFA/jour\\n\\nLes nouveaux param√®tres sont maintenant actifs.`);\n    }, 500);\n  }\n  saveIoTSettings() {\n    if (!this.settings.mqtt_broker || !this.settings.rfid_topic) {\n      alert('Veuillez remplir tous les champs IoT!');\n      return;\n    }\n    // Simuler la sauvegarde\n    setTimeout(() => {\n      alert(`‚úì Param√®tres IoT sauvegard√©s avec succ√®s!\\n\\n‚Ä¢ MQTT Broker: ${this.settings.mqtt_broker}\\n‚Ä¢ Topic RFID: ${this.settings.rfid_topic}\\n\\nLes dispositifs IoT vont red√©marrer avec les nouveaux param√®tres.`);\n    }, 500);\n  }\n  // M√©thodes pour retards et p√©nalit√©s\n  applyPenalty(overdue) {\n    if (confirm(`Appliquer une p√©nalit√© de ${overdue.penalty_amount} CFA √† ${overdue.user_name}?`)) {\n      // Ajouter √† l'historique des p√©nalit√©s\n      this.penaltyHistory.push({\n        id: Date.now(),\n        user_name: overdue.user_name,\n        book_title: overdue.book_title,\n        amount: overdue.penalty_amount,\n        applied_date: new Date(),\n        admin_name: this.currentUser?.name\n      });\n      // Marquer comme p√©nalis√©\n      overdue.penalty_applied = true;\n      overdue.penalty_date = new Date();\n      // Envoyer notification √† l'utilisateur\n      this.sendPenaltyNotification(overdue);\n      alert(`P√©nalit√© de ${overdue.penalty_amount} CFA appliqu√©e avec succ√®s!\\nNotification envoy√©e √† ${overdue.user_name}.`);\n    }\n  }\n  sendPenaltyNotification(overdue) {\n    // Simuler l'envoi de notification\n    console.log(`Notification envoy√©e √† ${overdue.user_name}: P√©nalit√© de ${overdue.penalty_amount} CFA appliqu√©e pour le livre \"${overdue.book_title}\"`);\n  }\n  blacklistUser(userId) {\n    if (confirm('Mettre cet utilisateur en liste noire?')) {\n      console.log('Utilisateur blacklist√©:', userId);\n      alert('Utilisateur ajout√© √† la liste noire!');\n    }\n  }\n  // M√©thodes pour demandes d'inscription\n  approveRequest(requestId) {\n    if (confirm('Approuver cette demande d\\'inscription?\\nL\\'utilisateur pourra acc√©der √† toutes les fonctionnalit√©s.')) {\n      // Trouver la demande avant de la supprimer\n      const approvedRequest = this.registrationRequests.find(r => r.id === requestId);\n      // Supprimer de la liste des demandes\n      this.registrationRequests = this.registrationRequests.filter(r => r.id !== requestId);\n      // Supprimer aussi du localStorage si c'est une nouvelle demande\n      const storedRequests = JSON.parse(localStorage.getItem('registrationRequests') || '[]');\n      const updatedRequests = storedRequests.filter(r => r.id !== requestId);\n      localStorage.setItem('registrationRequests', JSON.stringify(updatedRequests));\n      // Ajouter √† la liste des utilisateurs actifs\n      if (approvedRequest) {\n        const newUser = {\n          id: Date.now(),\n          name: approvedRequest.name,\n          surname: approvedRequest.surname,\n          email: approvedRequest.email,\n          role: 'user',\n          tag_uid: null,\n          active_borrows: 0,\n          status: 'approved',\n          photo_url: approvedRequest.photo_url,\n          created_at: new Date()\n        };\n        this.users.push(newUser);\n        // Mettre √† jour le statut dans le localStorage pour l'utilisateur connect√©\n        const currentUser = JSON.parse(localStorage.getItem('user') || '{}');\n        if (currentUser.email === approvedRequest.email) {\n          currentUser.status = 'approved';\n          currentUser.photo_url = approvedRequest.photo_url;\n          // Forcer la mise √† jour imm√©diate\n          this.authService.updateCurrentUser(currentUser);\n          // D√©clencher un √©v√©nement pour forcer le rafra√Æchissement\n          window.dispatchEvent(new CustomEvent('userStatusUpdated', {\n            detail: currentUser\n          }));\n        }\n        // Mettre √† jour aussi dans la liste des utilisateurs inscrits\n        const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');\n        const userIndex = registeredUsers.findIndex(u => u.email === approvedRequest.email);\n        if (userIndex !== -1) {\n          registeredUsers[userIndex].status = 'approved';\n          registeredUsers[userIndex].photo_url = approvedRequest.photo_url;\n          localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));\n        }\n        // Sauvegarder la photo dans le stockage s√©par√©\n        if (approvedRequest.photo_url) {\n          localStorage.setItem('userPhoto_' + approvedRequest.email, approvedRequest.photo_url);\n        }\n      }\n      alert('Demande approuv√©e avec succ√®s!\\nL\\'utilisateur peut maintenant emprunter des livres.');\n    }\n  }\n  rejectRequest(requestId) {\n    const reason = prompt('Raison du rejet (optionnel):');\n    if (confirm('Rejeter d√©finitivement cette demande d\\'inscription?')) {\n      this.registrationRequests = this.registrationRequests.filter(r => r.id !== requestId);\n      // Supprimer aussi du localStorage si c'est une nouvelle demande\n      const storedRequests = JSON.parse(localStorage.getItem('registrationRequests') || '[]');\n      const updatedRequests = storedRequests.filter(r => r.id !== requestId);\n      localStorage.setItem('registrationRequests', JSON.stringify(updatedRequests));\n      alert('Demande rejet√©e!\\nL\\'utilisateur a √©t√© notifi√© par email.');\n    }\n  }\n  requestDocument(requestId) {\n    const request = this.registrationRequests.find(r => r.id === requestId);\n    if (!request) return;\n    const documentType = prompt(`üìÑ DEMANDE DE JUSTIFICATIF\\n\\nUtilisateur: ${request.name} ${request.surname}\\nEmail: ${request.email}\\n\\nQuel document demander ?\\n\\nExemples:\\n- Carte d'√©tudiant\\n- Certificat de scolarit√©\\n- Attestation d'emploi\\n- Pi√®ce d'identit√©\\n- Justificatif de domicile`);\n    if (documentType && documentType.trim().length > 0) {\n      // Marquer comme document manquant\n      request.documents_uploaded = false;\n      request.requested_document = documentType;\n      request.document_request_date = new Date();\n      // Mettre √† jour dans localStorage\n      const storedRequests = JSON.parse(localStorage.getItem('registrationRequests') || '[]');\n      const requestIndex = storedRequests.findIndex(r => r.id === requestId);\n      if (requestIndex !== -1) {\n        storedRequests[requestIndex] = request;\n        localStorage.setItem('registrationRequests', JSON.stringify(storedRequests));\n      }\n      // Ajouter un log\n      this.auditLogs.unshift({\n        created_at: new Date(),\n        type: 'admin',\n        user_name: 'Admin',\n        action: 'Demande justificatif',\n        details: `Document demand√© √† ${request.name}: ${documentType}`\n      });\n      this.filteredLogs = [...this.auditLogs];\n      alert(`üìß Demande envoy√©e avec succ√®s!\\n\\nUtilisateur: ${request.name}\\nDocument demand√©: ${documentType}\\n\\n‚úâÔ∏è Un email a √©t√© envoy√© √† ${request.email} avec les instructions pour fournir ce document.`);\n    }\n  }\n  viewRequestProfile(request) {\n    let documentStatus = '';\n    if (request.documents_uploaded) {\n      documentStatus = '‚úì Documents upload√©s';\n    } else if (request.requested_document) {\n      documentStatus = `‚è≥ En attente: ${request.requested_document} (demand√© le ${new Date(request.document_request_date).toLocaleDateString('fr-FR')})`;\n    } else {\n      documentStatus = '‚ùå Documents manquants';\n    }\n    const profileInfo = `\nüìÑ PROFIL COMPLET DE LA DEMANDE\n\nüë§ INFORMATIONS PERSONNELLES\n‚Ä¢ Nom: ${request.name} ${request.surname}\n‚Ä¢ Email: ${request.email}\n‚Ä¢ √âtablissement: ${request.etablissement}\n\nüíº PROFESSION\n‚Ä¢ Type: ${this.getProfessionLabel(request.profession)}\n‚Ä¢ D√©tail: ${request.profession_detail}\n\nüéØ MOTIVATIONS\n\"${request.motivations}\"\n\nüìÖ Date de demande: ${new Date(request.created_at).toLocaleDateString('fr-FR')}\nüìÜ Statut documents: ${documentStatus}\n\n‚ÑπÔ∏è Que souhaitez-vous faire avec cette demande?`;\n    if (confirm(profileInfo + '\\n\\nCliquez OK pour APPROUVER ou Annuler pour continuer l\\'examen.')) {\n      this.approveRequest(request.id);\n    }\n  }\n  getProfessionLabel(profession) {\n    const labels = {\n      'etudiant': '√âtudiant',\n      'eleve': '√âl√®ve',\n      'entrepreneur': 'Entrepreneur',\n      'autre': 'Autre'\n    };\n    return labels[profession] || profession;\n  }\n  getPendingBorrowRequests() {\n    const borrowRequests = JSON.parse(localStorage.getItem('borrowRequests') || '[]');\n    return borrowRequests.filter(req => req.status === 'pending');\n  }\n  approveBorrowRequest(requestId) {\n    if (confirm('Approuver cette demande d\\'emprunt ?\\nL\\'utilisateur pourra venir r√©cup√©rer le livre.')) {\n      const borrowRequests = JSON.parse(localStorage.getItem('borrowRequests') || '[]');\n      const requestIndex = borrowRequests.findIndex(req => req.id === requestId);\n      if (requestIndex !== -1) {\n        borrowRequests[requestIndex].status = 'approved';\n        borrowRequests[requestIndex].admin_response = 'approved';\n        borrowRequests[requestIndex].approval_date = new Date().toISOString();\n        localStorage.setItem('borrowRequests', JSON.stringify(borrowRequests));\n        alert('Demande approuv√©e ! L\\'utilisateur recevra une notification et pourra venir r√©cup√©rer le livre.');\n      }\n    }\n  }\n  rejectBorrowRequest(requestId) {\n    const reason = prompt('Motif du rejet (obligatoire):');\n    if (reason && reason.trim().length > 0) {\n      if (confirm(`Rejeter cette demande d\\'emprunt ?\\nMotif: ${reason}`)) {\n        const borrowRequests = JSON.parse(localStorage.getItem('borrowRequests') || '[]');\n        const requestIndex = borrowRequests.findIndex(req => req.id === requestId);\n        if (requestIndex !== -1) {\n          borrowRequests[requestIndex].status = 'rejected';\n          borrowRequests[requestIndex].admin_response = 'rejected';\n          borrowRequests[requestIndex].rejection_reason = reason;\n          borrowRequests[requestIndex].rejection_date = new Date().toISOString();\n          localStorage.setItem('borrowRequests', JSON.stringify(borrowRequests));\n          alert('Demande rejet√©e. L\\'utilisateur recevra une notification avec le motif.');\n        }\n      }\n    } else if (reason !== null) {\n      alert('Le motif du rejet est obligatoire.');\n    }\n  }\n  // M√©thodes pour gestion utilisateurs\n  viewUserProfile(user) {\n    alert(`Profil utilisateur:\\n\\nNom: ${user.name} ${user.surname || ''}\\nEmail: ${user.email}\\nR√¥le: ${user.role}\\nStatut: ${user.status}\\nInscription: ${new Date(user.created_at).toLocaleDateString()}`);\n  }\n  assignUserTag(user) {\n    const tagUid = prompt('Entrez l\\'UID du tag RFID pour cet utilisateur:', user.tag_uid || '');\n    if (tagUid) {\n      user.tag_uid = tagUid;\n      alert('Tag assign√© √† l\\'utilisateur avec succ√®s!');\n    }\n  }\n  toggleUserStatus(user) {\n    const action = user.status === 'active' ? 'suspendre' : 'activer';\n    if (confirm(`${action.charAt(0).toUpperCase() + action.slice(1)} l\\'utilisateur ${user.name}?`)) {\n      user.status = user.status === 'active' ? 'suspended' : 'active';\n      alert(`Utilisateur ${action} avec succ√®s!`);\n    }\n  }\n  deleteUser(user) {\n    const reason = prompt(`‚ö†Ô∏è SUPPRESSION D\\'UTILISATEUR\\n\\nUtilisateur: ${user.name}\\nEmail: ${user.email}\\n\\nPourquoi supprimer cet utilisateur ?\\n(Cette action est irr√©versible)`);\n    if (reason && reason.trim().length > 0) {\n      if (confirm(`üóëÔ∏è CONFIRMATION DE SUPPRESSION\\n\\nUtilisateur: ${user.name}\\nRaison: ${reason}\\n\\n‚ö†Ô∏è Cette action supprimera d√©finitivement:\\n- Le compte utilisateur\\n- Tous ses emprunts\\n- Son historique\\n\\n√ätes-vous absolument s√ªr ?`)) {\n        // Supprimer de la liste locale\n        this.users = this.users.filter(u => u.id !== user.id);\n        // Supprimer des utilisateurs enregistr√©s\n        const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');\n        const updatedUsers = registeredUsers.filter(u => u.id !== user.id);\n        localStorage.setItem('registeredUsers', JSON.stringify(updatedUsers));\n        // Ajouter un log de suppression\n        this.auditLogs.unshift({\n          created_at: new Date(),\n          type: 'admin',\n          user_name: 'Admin',\n          action: 'Suppression utilisateur',\n          details: `Utilisateur supprim√©: ${user.name} (${user.email}) - Raison: ${reason}`\n        });\n        this.filteredLogs = [...this.auditLogs];\n        alert(`‚úÖ Utilisateur supprim√© avec succ√®s!\\n\\nUtilisateur: ${user.name}\\nRaison: ${reason}\\n\\nLa suppression a √©t√© enregistr√©e dans les logs.`);\n      }\n    } else if (reason !== null) {\n      alert('‚ùå Suppression annul√©e\\n\\nVous devez pr√©ciser une raison pour supprimer un utilisateur.');\n    }\n  }\n  hasNewRegistrations() {\n    if (this.alertDismissed) return false;\n    const storedRequests = JSON.parse(localStorage.getItem('registrationRequests') || '[]');\n    return storedRequests.some(req => !this.viewedNotifications.has(req.id));\n  }\n  getNewRegistrationsCount() {\n    const storedRequests = JSON.parse(localStorage.getItem('registrationRequests') || '[]');\n    return storedRequests.filter(req => !this.viewedNotifications.has(req.id)).length;\n  }\n  markNotificationsAsViewed() {\n    const storedRequests = JSON.parse(localStorage.getItem('registrationRequests') || '[]');\n    storedRequests.forEach(req => this.viewedNotifications.add(req.id));\n  }\n  dismissAlert() {\n    this.alertDismissed = true;\n  }\n  getFilteredBorrows() {\n    let filteredBorrows = this.borrows;\n    if (this.borrowView === 'current') {\n      // Emprunts en cours (approved, active)\n      filteredBorrows = this.borrows.filter(borrow => borrow.status === 'approved' || borrow.status === 'active');\n    } else if (this.borrowView === 'history') {\n      // Historique (returned, rejected, overdue)\n      filteredBorrows = this.borrows.filter(borrow => borrow.status === 'returned' || borrow.status === 'rejected' || borrow.status === 'overdue');\n    }\n    return filteredBorrows;\n  }\n  getFilteredUsers() {\n    let filteredUsers = this.users;\n    // Filtrer par recherche\n    if (this.userSearch) {\n      filteredUsers = filteredUsers.filter(user => user.name.toLowerCase().includes(this.userSearch.toLowerCase()) || user.email.toLowerCase().includes(this.userSearch.toLowerCase()) || user.surname && user.surname.toLowerCase().includes(this.userSearch.toLowerCase()));\n    }\n    // Filtrer par r√¥le\n    if (this.userRoleFilter) {\n      filteredUsers = filteredUsers.filter(user => user.role === this.userRoleFilter);\n    }\n    // Filtrer par statut\n    if (this.userStatusFilter) {\n      filteredUsers = filteredUsers.filter(user => user.status === this.userStatusFilter);\n    }\n    return filteredUsers;\n  }\n  getUserActiveBorrows(userId) {\n    return this.borrows.filter(borrow => borrow.user_id === userId && (borrow.status === 'active' || borrow.status === 'approved')).length;\n  }\n  getBorrowStatusClass(status) {\n    const classes = {\n      'pending': 'bg-warning',\n      'approved': 'bg-info',\n      'active': 'bg-primary',\n      'returned': 'bg-success',\n      'overdue': 'bg-danger',\n      'rejected': 'bg-danger'\n    };\n    return classes[status] || 'bg-secondary';\n  }\n  onUserImageError(event) {\n    event.target.src = this.getDefaultUserImage();\n  }\n  getDefaultUserImage() {\n    return 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiNlOWVjZWYiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4PSI4IiB5PSI4Ij4KPHBhdGggZD0iTTEyIDEyQzE0LjIwOTEgMTIgMTYgMTAuMjA5MSAxNiA4QzE2IDUuNzkwODYgMTQuMjA5MSA0IDEyIDRDOS43OTA4NiA0IDggNS43OTA4NiA4IDhDOCAxMC4yMDkxIDkuNzkwODYgMTIgMTIgMTJaIiBmaWxsPSIjNmM3NTdkIi8+CjxwYXRoIGQ9Ik0xMiAxNEM5LjMzIDEzLjk5IDcuMDEgMTUuNjIgNiAxOEMxMC4wMSAyMCAxMy45OSAyMCAxOCAxOEMxNi45OSAxNS42MiAxNC42NyAxMy45OSAxMiAxNFoiIGZpbGw9IiM2Yzc1N2QiLz4KPC9zdmc+Cjwvc3ZnPgo=';\n  }\n  logout() {\n    this.authService.logout();\n    this.router.navigate(['/login']);\n  }\n};\nAdminDashboardComponent = __decorate([Component({\n  selector: 'app-admin-dashboard',\n  standalone: true,\n  imports: [CommonModule, FormsModule],\n  template: `\n    <div class=\"admin-layout\">\n      <!-- Sidebar -->\n      <div class=\"sidebar\">\n        <div class=\"sidebar-header\">\n          <div class=\"logo-container mb-2\">\n            <div class=\"admin-logo\">\n              <div class=\"mini-wifi\"></div>\n              <div class=\"mini-book\"></div>\n            </div>\n          </div>\n          <h4>Admin</h4>\n          <p class=\"text-muted\">{{currentUser?.name}}</p>\n        </div>\n        <nav class=\"sidebar-nav\">\n          <a class=\"nav-item\" [class.active]=\"activeTab === 'dashboard'\" (click)=\"setActiveTab('dashboard')\">\n            <i class=\"fas fa-tachometer-alt\"></i> Tableau de bord\n          </a>\n          <a class=\"nav-item\" [class.active]=\"activeTab === 'users'\" (click)=\"setActiveTab('users')\">\n            <i class=\"fas fa-users\"></i> Utilisateurs\n            <span *ngIf=\"users.length > 0\" class=\"nav-badge\">{{users.length}}</span>\n          </a>\n          <a class=\"nav-item\" [class.active]=\"activeTab === 'borrows'\" (click)=\"setActiveTab('borrows')\">\n            <i class=\"fas fa-handshake\"></i> Emprunts\n            <span *ngIf=\"getPendingBorrowRequests().length > 0\" class=\"nav-badge bg-warning\">{{getPendingBorrowRequests().length}}</span>\n          </a>\n          <a class=\"nav-item\" [class.active]=\"activeTab === 'books'\" (click)=\"setActiveTab('books')\">\n            <i class=\"fas fa-book\"></i> Livres / Catalogue\n            <span *ngIf=\"books.length > 0\" class=\"nav-badge\">{{books.length}}</span>\n          </a>\n          <a class=\"nav-item\" [class.active]=\"activeTab === 'inventory'\" (click)=\"setActiveTab('inventory')\">\n            <i class=\"fas fa-warehouse\"></i> Inventaire (IoT)\n            <span *ngIf=\"iotDevices.length > 0\" class=\"nav-badge\">{{iotDevices.length}}</span>\n          </a>\n          <a class=\"nav-item\" [class.active]=\"activeTab === 'overdue'\" (click)=\"setActiveTab('overdue')\">\n            <i class=\"fas fa-exclamation-triangle\"></i> Retards & P√©nalit√©s\n            <span *ngIf=\"overdueBorrows.length > 0\" class=\"nav-badge bg-danger\">{{overdueBorrows.length}}</span>\n          </a>\n          <a class=\"nav-item\" [class.active]=\"activeTab === 'requests'\" (click)=\"setActiveTab('requests')\">\n            <i class=\"fas fa-clipboard-list\"></i> Demandes / Inscriptions\n            <span *ngIf=\"registrationRequests.length > 0\" class=\"nav-badge\">{{registrationRequests.length}}</span>\n          </a>\n          <a class=\"nav-item\" [class.active]=\"activeTab === 'reports'\" (click)=\"setActiveTab('reports')\">\n            <i class=\"fas fa-chart-bar\"></i> Statistiques & Rapports\n          </a>\n          <a class=\"nav-item\" [class.active]=\"activeTab === 'settings'\" (click)=\"setActiveTab('settings')\">\n            <i class=\"fas fa-cog\"></i> Configuration\n          </a>\n          <a class=\"nav-item\" [class.active]=\"activeTab === 'logs'\" (click)=\"setActiveTab('logs')\">\n            <i class=\"fas fa-file-alt\"></i> Logs / Audit\n            <span *ngIf=\"auditLogs.length > 0\" class=\"nav-badge\">{{auditLogs.length}}</span>\n          </a>\n        </nav>\n        <div class=\"sidebar-footer\">\n          <button class=\"btn btn-danger btn-sm w-100\" (click)=\"logout()\">\n            <i class=\"fas fa-sign-out-alt\"></i> D√©connexion\n          </button>\n        </div>\n      </div>\n\n      <!-- Main Content -->\n      <div class=\"main-content\">\n        <!-- Header -->\n        <div class=\"content-header\">\n          <h3>{{getTabTitle()}}</h3>\n          <div class=\"breadcrumb\">\n            <span>Admin</span> <i class=\"fas fa-chevron-right\"></i> <span>{{getTabTitle()}}</span>\n          </div>\n        </div>\n\n        <!-- Dashboard -->\n        <div *ngIf=\"activeTab === 'dashboard' && stats\" class=\"content-body\">\n          <!-- Notifications admin - uniquement pour nouvelles demandes -->\n          <div *ngIf=\"hasNewRegistrations()\" class=\"alert alert-info mb-4 alert-dismissible\">\n            <div class=\"d-flex align-items-center\">\n              <i class=\"fas fa-bell fa-2x me-3\"></i>\n              <div class=\"flex-grow-1\">\n                <h5 class=\"mb-1\">üîî Nouvelle(s) demande(s) d'inscription</h5>\n                <p class=\"mb-2\">{{getNewRegistrationsCount()}} nouvelle(s) demande(s) en attente de votre approbation</p>\n                <button class=\"btn btn-primary btn-sm\" (click)=\"setActiveTab('requests'); markNotificationsAsViewed()\">\n                  <i class=\"fas fa-eye me-1\"></i>Examiner les demandes\n                </button>\n              </div>\n              <span class=\"badge bg-warning fs-6\">{{getNewRegistrationsCount()}}</span>\n              <button type=\"button\" class=\"btn-close\" (click)=\"dismissAlert()\"></button>\n            </div>\n          </div>\n        <div class=\"row mb-4\">\n          <div class=\"col-md-3\">\n            <div class=\"card bg-primary text-white\">\n              <div class=\"card-body\">\n                <div class=\"d-flex justify-content-between\">\n                  <div>\n                    <h4>{{stats.stats.total_books}}</h4>\n                    <p>Livres Total</p>\n                  </div>\n                  <i class=\"fas fa-book fa-2x\"></i>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div class=\"col-md-3\">\n            <div class=\"card bg-success text-white\">\n              <div class=\"card-body\">\n                <div class=\"d-flex justify-content-between\">\n                  <div>\n                    <h4>{{stats.stats.total_users}}</h4>\n                    <p>Utilisateurs</p>\n                  </div>\n                  <i class=\"fas fa-users fa-2x\"></i>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div class=\"col-md-3\">\n            <div class=\"card bg-info text-white\">\n              <div class=\"card-body\">\n                <div class=\"d-flex justify-content-between\">\n                  <div>\n                    <h4>{{stats.stats.active_borrows}}</h4>\n                    <p>Emprunts Actifs</p>\n                  </div>\n                  <i class=\"fas fa-handshake fa-2x\"></i>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div class=\"col-md-3\">\n            <div class=\"card bg-warning text-white\">\n              <div class=\"card-body\">\n                <div class=\"d-flex justify-content-between\">\n                  <div>\n                    <h4>{{stats.stats.overdue_borrows}}</h4>\n                    <p>En Retard</p>\n                  </div>\n                  <i class=\"fas fa-exclamation-triangle fa-2x\"></i>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"row\">\n          <div class=\"col-md-6\">\n            <div class=\"card\">\n              <div class=\"card-header\">\n                <h5><i class=\"fas fa-star\"></i> Livres Populaires</h5>\n              </div>\n              <div class=\"card-body\">\n                <div *ngFor=\"let book of stats.popular_books\" class=\"mb-2\">\n                  <strong>{{book.title}}</strong> - {{book.author}}\n                  <small class=\"text-muted\">({{book.borrow_count}} emprunts)</small>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div class=\"col-md-6\">\n            <div class=\"card\">\n              <div class=\"card-header\">\n                <h5><i class=\"fas fa-clock\"></i> Emprunts R√©cents</h5>\n              </div>\n              <div class=\"card-body\">\n                <div *ngFor=\"let borrow of stats.recent_borrows\" class=\"mb-2\">\n                  <strong>{{borrow.book_title}}</strong>\n                  <br><small class=\"text-muted\">{{borrow.user_name}} - {{borrow.date_emprunt | date}}</small>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n        <!-- Livres / Catalogue -->\n        <div *ngIf=\"activeTab === 'books'\" class=\"content-body\">\n          <div class=\"d-flex justify-content-between align-items-center mb-4\">\n            <div class=\"search-filters\">\n              <input type=\"text\" class=\"form-control\" placeholder=\"Recherche titre, auteur, ISBN...\" [(ngModel)]=\"bookSearch\" (input)=\"searchBooks()\">\n              <select class=\"form-select ms-2\" [(ngModel)]=\"bookCategoryFilter\" (change)=\"filterBooks()\">\n                <option value=\"\">Toutes cat√©gories</option>\n                <option *ngFor=\"let cat of categories\" [value]=\"cat.id\">{{cat.name}}</option>\n              </select>\n              <select class=\"form-select ms-2\" [(ngModel)]=\"bookAvailabilityFilter\" (change)=\"filterBooks()\">\n                <option value=\"\">Toutes</option>\n                <option value=\"1\">Disponibles</option>\n                <option value=\"0\">Indisponibles</option>\n              </select>\n            </div>\n            <div>\n              <button class=\"btn btn-outline-secondary me-2\" (click)=\"exportBooks()\">Export CSV</button>\n              <button class=\"btn btn-success\" (click)=\"showAddBookForm = true\">+ Ajouter Livre</button>\n            </div>\n          </div>\n\n          <!-- Table des livres -->\n          <div class=\"table-responsive\">\n            <table class=\"table table-hover\">\n              <thead>\n                <tr>\n                  <th><input type=\"checkbox\" (change)=\"selectAllBooks($event)\"></th>\n                  <th>Couverture</th>\n                  <th>Titre</th>\n                  <th>Auteur(s)</th>\n                  <th>ISBN</th>\n                  <th>Cat√©gorie</th>\n                  <th>Localisation</th>\n                  <th>Stock</th>\n                  <th>Tag UID</th>\n                  <th>Actions</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr *ngFor=\"let book of filteredBooks\">\n                  <td><input type=\"checkbox\" [value]=\"book.id\" (change)=\"toggleBookSelection(book.id, $event)\"></td>\n                  <td><img [src]=\"book.cover_url || 'assets/book-placeholder.jpg'\" width=\"40\" height=\"56\" class=\"book-cover\"></td>\n                  <td>\n                    <strong>{{book.title}}</strong>\n                    <br><small class=\"text-muted\">{{book.times_borrowed || 0}} emprunts</small>\n                  </td>\n                  <td>{{book.author}}</td>\n                  <td>{{book.isbn}}</td>\n                  <td>{{book.category?.name}}</td>\n                  <td>{{book.location || 'Non d√©finie'}}</td>\n                  <td>\n                    <span [class]=\"book.stock > 0 ? 'text-success' : 'text-danger'\">{{book.available || 0}}/{{book.stock}}</span>\n                  </td>\n                  <td>{{book.tag_uid || '‚Äî'}}</td>\n                  <td>\n                    <button class=\"btn btn-sm btn-outline-primary me-1\" (click)=\"viewBook(book)\" title=\"Voir\">\n                      <i class=\"fas fa-eye\"></i>\n                    </button>\n                    <button class=\"btn btn-sm btn-outline-secondary me-1\" (click)=\"editBook(book)\" title=\"√âditer\">\n                      <i class=\"fas fa-edit\"></i>\n                    </button>\n                    <button class=\"btn btn-sm btn-outline-info me-1\" (click)=\"assignTag(book)\" title=\"Assigner Tag\">\n                      <i class=\"fas fa-tag\"></i>\n                    </button>\n                    <button class=\"btn btn-sm btn-outline-danger\" (click)=\"confirmDeleteBook(book)\" title=\"Supprimer\">\n                      <i class=\"fas fa-trash\"></i>\n                    </button>\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        <div class=\"row mb-3\">\n          <div class=\"col-md-8\">\n            <h4>Gestion des Livres</h4>\n          </div>\n          <div class=\"col-md-4\">\n            <button class=\"btn btn-success w-100\" (click)=\"showAddBookForm = true\">\n              <i class=\"fas fa-plus\"></i> Ajouter un Livre\n            </button>\n          </div>\n        </div>\n\n          <!-- Formulaire d'ajout -->\n          <div class=\"card mb-4\" *ngIf=\"showAddBookForm\">\n            <div class=\"card-header\">\n              <h5>Nouveau Livre</h5>\n            </div>\n            <div class=\"card-body\">\n              <form (ngSubmit)=\"addBook()\">\n                <div class=\"row\">\n                  <div class=\"col-md-6\">\n                    <div class=\"mb-3\">\n                      <label class=\"form-label\">Titre</label>\n                      <input type=\"text\" class=\"form-control\" [(ngModel)]=\"newBook.title\" name=\"title\" required>\n                    </div>\n                  </div>\n                  <div class=\"col-md-6\">\n                    <div class=\"mb-3\">\n                      <label class=\"form-label\">Auteur</label>\n                      <input type=\"text\" class=\"form-control\" [(ngModel)]=\"newBook.author\" name=\"author\" required>\n                    </div>\n                  </div>\n                </div>\n                <div class=\"row\">\n                  <div class=\"col-md-4\">\n                    <div class=\"mb-3\">\n                      <label class=\"form-label\">ISBN</label>\n                      <input type=\"text\" class=\"form-control\" [(ngModel)]=\"newBook.isbn\" name=\"isbn\" required>\n                    </div>\n                  </div>\n                  <div class=\"col-md-4\">\n                    <div class=\"mb-3\">\n                      <label class=\"form-label\">Cat√©gorie</label>\n                      <div class=\"input-group\">\n                        <select class=\"form-select\" [(ngModel)]=\"newBook.category_id\" name=\"category_id\" required>\n                          <option value=\"\">S√©lectionner...</option>\n                          <option *ngFor=\"let category of categories\" [value]=\"category.id\">\n                            {{category.name}}\n                          </option>\n                        </select>\n                        <button type=\"button\" class=\"btn btn-outline-primary\" (click)=\"showAddCategoryForm = true\">\n                          <i class=\"fas fa-plus\"></i>\n                        </button>\n                      </div>\n                    </div>\n                  </div>\n                  <div class=\"col-md-4\">\n                    <div class=\"mb-3\">\n                      <label class=\"form-label\">Stock</label>\n                      <input type=\"number\" class=\"form-control\" [(ngModel)]=\"newBook.stock\" name=\"stock\" required min=\"1\">\n                    </div>\n                  </div>\n                </div>\n                \n                <!-- Formulaire ajout cat√©gorie -->\n                <div *ngIf=\"showAddCategoryForm\" class=\"alert alert-info\">\n                  <div class=\"row\">\n                    <div class=\"col-md-6\">\n                      <input type=\"text\" class=\"form-control\" placeholder=\"Nom de la cat√©gorie\" [(ngModel)]=\"newCategory.name\" name=\"categoryName\">\n                    </div>\n                    <div class=\"col-md-4\">\n                      <input type=\"text\" class=\"form-control\" placeholder=\"Description\" [(ngModel)]=\"newCategory.description\" name=\"categoryDesc\">\n                    </div>\n                    <div class=\"col-md-2\">\n                      <button type=\"button\" class=\"btn btn-success btn-sm\" (click)=\"addNewCategory()\">\n                        <i class=\"fas fa-check\"></i>\n                      </button>\n                      <button type=\"button\" class=\"btn btn-secondary btn-sm ms-1\" (click)=\"showAddCategoryForm = false\">\n                        <i class=\"fas fa-times\"></i>\n                      </button>\n                    </div>\n                  </div>\n                </div>\n                \n                <div class=\"mb-3\">\n                  <label class=\"form-label\">Couverture du livre</label>\n                  <input type=\"file\" class=\"form-control\" (change)=\"onBookCoverSelect($event)\" accept=\"image/*\">\n                  <small class=\"text-muted\">Ou laissez vide pour une couverture par d√©faut selon la cat√©gorie</small>\n                  <div *ngIf=\"newBook.cover_preview\" class=\"mt-2\">\n                    <img [src]=\"newBook.cover_preview\" width=\"100\" height=\"140\" class=\"book-cover-preview\">\n                  </div>\n                </div>\n                <div class=\"mb-3\">\n                  <label class=\"form-label\">Description</label>\n                  <textarea class=\"form-control\" [(ngModel)]=\"newBook.description\" name=\"description\" rows=\"3\" placeholder=\"R√©sum√© du livre, synopsis...\"></textarea>\n                </div>\n                <div class=\"d-flex gap-2\">\n                  <button type=\"submit\" class=\"btn btn-success\">Ajouter</button>\n                  <button type=\"button\" class=\"btn btn-secondary\" (click)=\"cancelAddBook()\">Annuler</button>\n                </div>\n              </form>\n            </div>\n          </div>\n\n        <!-- Liste des livres -->\n        <div class=\"row\">\n          <div class=\"col-md-4 mb-3\" *ngFor=\"let book of books\">\n            <div class=\"card\">\n              <div class=\"card-body\">\n                <h6 class=\"card-title\">{{book.title}}</h6>\n                <p class=\"card-text\">\n                  <strong>Auteur:</strong> {{book.author}}<br>\n                  <strong>Cat√©gorie:</strong> {{book.category?.name}}<br>\n                  <strong>Stock:</strong> {{book.available}}/{{book.stock}}\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n        <!-- Utilisateurs -->\n        <div *ngIf=\"activeTab === 'users'\" class=\"content-body\">\n          <div class=\"d-flex justify-content-between align-items-center mb-4\">\n            <div class=\"search-filters\">\n              <input type=\"text\" class=\"form-control\" placeholder=\"Recherche nom, email...\" [(ngModel)]=\"userSearch\">\n              <select class=\"form-select ms-2\" [(ngModel)]=\"userRoleFilter\">\n                <option value=\"\">Tous r√¥les</option>\n                <option value=\"user\">Utilisateur</option>\n                <option value=\"admin\">Admin</option>\n              </select>\n              <select class=\"form-select ms-2\" [(ngModel)]=\"userStatusFilter\">\n                <option value=\"\">Tous statuts</option>\n                <option value=\"active\">Actif</option>\n                <option value=\"suspended\">Suspendu</option>\n              </select>\n            </div>\n            <button class=\"btn btn-outline-secondary\">Export CSV</button>\n          </div>\n\n          <div class=\"table-responsive\">\n            <table class=\"table table-hover\">\n              <thead>\n                <tr>\n                  <th>ID</th>\n                  <th>Nom Pr√©nom</th>\n                  <th>Email</th>\n                  <th>R√¥le</th>\n                  <th>Tag UID</th>\n                  <th>Emprunts en cours</th>\n                  <th>Statut</th>\n                  <th>Inscription</th>\n                  <th>Actions</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr *ngFor=\"let user of getFilteredUsers()\">\n                  <td>{{user.id}}</td>\n                  <td>\n                    <div class=\"d-flex align-items-center\">\n                      <img *ngIf=\"user.status === 'approved' && user.photo_url\" \n                           [src]=\"user.photo_url\" \n                           alt=\"Photo\" \n                           class=\"user-photo me-2\"\n                           (error)=\"onUserImageError($event)\">\n                      <span>{{user.name}} {{user.surname || ''}}</span>\n                    </div>\n                  </td>\n                  <td>{{user.email}}</td>\n                  <td><span class=\"badge bg-primary\">{{user.role || 'user'}}</span></td>\n                  <td>{{user.tag_uid || '‚Äî'}}</td>\n                  <td>{{getUserActiveBorrows(user.id)}}</td>\n                  <td><span class=\"badge\" [class]=\"user.status === 'approved' ? 'bg-success' : 'bg-warning'\">{{getStatusLabel(user.status)}}</span></td>\n                  <td>{{user.created_at | date:'short'}}</td>\n                  <td>\n                    <button class=\"btn btn-sm btn-outline-primary me-1\" (click)=\"viewUserProfile(user)\" title=\"Voir profil\">\n                      <i class=\"fas fa-eye\"></i>\n                    </button>\n                    <button class=\"btn btn-sm btn-outline-info me-1\" (click)=\"assignUserTag(user)\" title=\"Assigner tag\">\n                      <i class=\"fas fa-id-card\"></i>\n                    </button>\n                    <button class=\"btn btn-sm\" [class]=\"user.status === 'active' ? 'btn-outline-warning' : 'btn-outline-success'\" (click)=\"toggleUserStatus(user)\" title=\"Suspendre/Activer\">\n                      <i class=\"fas\" [class]=\"user.status === 'active' ? 'fa-ban' : 'fa-check'\"></i>\n                    </button>\n                    <button class=\"btn btn-sm btn-outline-danger ms-1\" (click)=\"deleteUser(user)\" title=\"Supprimer utilisateur\">\n                      <i class=\"fas fa-trash\"></i>\n                    </button>\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n            <div *ngIf=\"getFilteredUsers().length === 0\" class=\"text-center py-4\">\n              <i class=\"fas fa-users fa-3x text-muted mb-3\"></i>\n              <p class=\"text-muted\">Aucun utilisateur certifi√© trouv√©</p>\n              <small>Les utilisateurs apparaissent ici apr√®s validation de leur inscription</small>\n            </div>\n            </table>\n          </div>\n        </div>\n\n        <!-- Emprunts -->\n        <div *ngIf=\"activeTab === 'borrows'\" class=\"content-body\">\n          <div class=\"row mb-4\">\n            <div class=\"col-md-2\">\n              <button class=\"btn\" [class]=\"borrowView === 'pending' ? 'btn-warning' : 'btn-outline-warning'\" (click)=\"borrowView = 'pending'\">\n                Demandes\n                <span *ngIf=\"getPendingBorrowRequests().length > 0\" class=\"badge bg-danger ms-1\">{{getPendingBorrowRequests().length}}</span>\n              </button>\n            </div>\n            <div class=\"col-md-2\">\n              <button class=\"btn\" [class]=\"borrowView === 'current' ? 'btn-primary' : 'btn-outline-primary'\" (click)=\"borrowView = 'current'\">En cours</button>\n            </div>\n            <div class=\"col-md-2\">\n              <button class=\"btn\" [class]=\"borrowView === 'history' ? 'btn-primary' : 'btn-outline-primary'\" (click)=\"borrowView = 'history'\">Historique</button>\n            </div>\n            <div class=\"col-md-6\">\n              <input type=\"text\" class=\"form-control\" placeholder=\"Recherche par livre ou utilisateur...\">\n            </div>\n          </div>\n          <!-- Demandes en attente -->\n          <div *ngIf=\"borrowView === 'pending'\" class=\"table-responsive\">\n            <table class=\"table table-hover\">\n              <thead>\n                <tr>\n                  <th>Utilisateur</th>\n                  <th>Livre</th>\n                  <th>Date demande</th>\n                  <th>Statut</th>\n                  <th>Actions</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr *ngFor=\"let request of getPendingBorrowRequests()\">\n                  <td>{{request.user_name}}</td>\n                  <td>{{request.book_title}}</td>\n                  <td>{{request.request_date | date:'short'}}</td>\n                  <td><span class=\"badge bg-warning\">En attente</span></td>\n                  <td>\n                    <button class=\"btn btn-sm btn-success me-1\" (click)=\"approveBorrowRequest(request.id)\" title=\"Approuver\">\n                      <i class=\"fas fa-check\"></i> Approuver\n                    </button>\n                    <button class=\"btn btn-sm btn-danger\" (click)=\"rejectBorrowRequest(request.id)\" title=\"Rejeter\">\n                      <i class=\"fas fa-times\"></i> Rejeter\n                    </button>\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n            <div *ngIf=\"getPendingBorrowRequests().length === 0\" class=\"text-center py-4\">\n              <i class=\"fas fa-clipboard-check fa-3x text-muted mb-3\"></i>\n              <p class=\"text-muted\">Aucune demande d'emprunt en attente</p>\n            </div>\n          </div>\n\n          <!-- Emprunts en cours et historique -->\n          <div *ngIf=\"borrowView !== 'pending'\" class=\"table-responsive\">\n            <table class=\"table table-hover\">\n              <thead>\n                <tr>\n                  <th>ID</th>\n                  <th>Livre</th>\n                  <th>Utilisateur</th>\n                  <th>Date emprunt</th>\n                  <th>Date retour pr√©vue</th>\n                  <th>Statut</th>\n                  <th>Actions</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr *ngFor=\"let borrow of getFilteredBorrows()\">\n                  <td>{{borrow.id}}</td>\n                  <td>{{borrow.book_title || borrow.title}}</td>\n                  <td>{{borrow.user_name}}</td>\n                  <td>{{borrow.request_date || borrow.date_emprunt | date:'short'}}</td>\n                  <td>{{borrow.due_date || borrow.date_retour_prevue | date:'short'}}</td>\n                  <td>\n                    <span class=\"badge\" [class]=\"getBorrowStatusClass(borrow.status)\">{{getStatusLabel(borrow.status)}}</span>\n                  </td>\n                  <td>\n                    <button *ngIf=\"borrow.status === 'active' || borrow.status === 'approved'\" \n                            class=\"btn btn-sm btn-outline-success me-1\" \n                            (click)=\"returnBook(borrow.id)\" \n                            title=\"Marquer retourn√©\">\n                      <i class=\"fas fa-check\"></i>\n                    </button>\n                    <button *ngIf=\"borrow.status === 'active'\" \n                            class=\"btn btn-sm btn-outline-primary me-1\" \n                            title=\"Prolonger\">\n                      <i class=\"fas fa-calendar-plus\"></i>\n                    </button>\n                    <button *ngIf=\"borrow.status === 'active' || borrow.status === 'overdue'\" \n                            class=\"btn btn-sm btn-outline-warning\" \n                            title=\"Envoyer rappel\">\n                      <i class=\"fas fa-envelope\"></i>\n                    </button>\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n            <div *ngIf=\"getFilteredBorrows().length === 0\" class=\"text-center py-4\">\n              <i class=\"fas fa-book fa-3x text-muted mb-3\"></i>\n              <p class=\"text-muted\">{{borrowView === 'current' ? 'Aucun emprunt en cours' : 'Aucun historique d\\'emprunt'}}</p>\n            </div>\n          </div>\n        </div>\n\n        <!-- Inventaire IoT -->\n        <div *ngIf=\"activeTab === 'inventory'\" class=\"content-body\">\n          <div class=\"alert alert-warning mb-4\">\n            <i class=\"fas fa-exclamation-triangle\"></i>\n            <strong>Fonctionnalit√© IoT non configur√©e</strong><br>\n            Connectez un Raspberry Pi avec lecteur RFID pour activer l'inventaire automatique.\n          </div>\n          \n          <div class=\"row mb-4\">\n            <div class=\"col-md-6\">\n              <div class=\"card\">\n                <div class=\"card-header\">\n                  <h5><i class=\"fas fa-wifi\"></i> Devices IoT</h5>\n                </div>\n                <div class=\"card-body\">\n                  <div *ngIf=\"iotDevices.length === 0\" class=\"text-center py-4\">\n                    <i class=\"fas fa-plug fa-3x text-muted mb-3\"></i>\n                    <p class=\"text-muted\">Aucun dispositif connect√©</p>\n                    <small>Connectez un Raspberry Pi pour commencer</small>\n                  </div>\n                  <div class=\"device-item\" *ngFor=\"let device of iotDevices\">\n                    <div class=\"d-flex justify-content-between align-items-center\">\n                      <div>\n                        <strong>{{device.name}}</strong>\n                        <br><small class=\"text-muted\">{{device.type}}</small>\n                      </div>\n                      <span class=\"badge\" [class]=\"device.status === 'online' ? 'bg-success' : 'bg-danger'\">\n                        {{device.status}}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div class=\"col-md-6\">\n              <div class=\"card\">\n                <div class=\"card-header\">\n                  <h5><i class=\"fas fa-search\"></i> Inventaire temps r√©el</h5>\n                </div>\n                <div class=\"card-body\">\n                  <button class=\"btn btn-primary mb-3\" (click)=\"startInventoryScan()\">\n                    <i class=\"fas fa-barcode\"></i> Lancer scan manuel\n                  </button>\n                  <div *ngIf=\"shelves.length === 0\" class=\"text-muted\">\n                    <i class=\"fas fa-info-circle\"></i> Aucun scan effectu√©\n                  </div>\n                  <div *ngFor=\"let shelf of shelves\" class=\"mb-2\">\n                    <div class=\"d-flex justify-content-between\">\n                      <strong>{{shelf.name}}</strong>\n                      <span class=\"badge bg-info\">{{shelf.detected_books}} livres</span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n          \n          <div class=\"row\">\n            <div class=\"col-12\">\n              <div class=\"card\">\n                <div class=\"card-header\">\n                  <h5><i class=\"fas fa-info-circle\"></i> Qu'est-ce qu'un Raspberry Pi ?</h5>\n                </div>\n                <div class=\"card-body\">\n                  <div class=\"row\">\n                    <div class=\"col-md-8\">\n                      <h6>üîå Raspberry Pi - Mini-ordinateur</h6>\n                      <p>Un <strong>Raspberry Pi</strong> est un petit ordinateur de la taille d'une carte de cr√©dit qui co√ªte environ <strong>35-50‚Ç¨</strong>.</p>\n                      \n                      <h6>üì∂ Fonctionnalit√© RFID pour Biblioth√®que</h6>\n                      <ul>\n                        <li><strong>Lecture automatique</strong> : Scanne les puces RFID coll√©es sur les livres</li>\n                        <li><strong>Inventaire temps r√©el</strong> : Compte automatiquement les livres sur les √©tag√®res</li>\n                        <li><strong>Localisation</strong> : Sait o√π se trouve chaque livre</li>\n                        <li><strong>Emprunts rapides</strong> : Scan instantan√© sans saisie manuelle</li>\n                      </ul>\n                      \n                      <h6>üõçÔ∏è Mat√©riel N√©cessaire</h6>\n                      <ul>\n                        <li>Raspberry Pi 4 (50‚Ç¨)</li>\n                        <li>Lecteur RFID RC522 (10‚Ç¨)</li>\n                        <li>Puces RFID pour livres (0.50‚Ç¨/pi√®ce)</li>\n                        <li>C√¢bles de connexion (5‚Ç¨)</li>\n                      </ul>\n                      \n                      <div class=\"alert alert-info mt-3\">\n                        <strong>üí° Alternative Simple</strong><br>\n                        Vous pouvez utiliser eLibrary sans IoT ! L'inventaire manuel fonctionne tr√®s bien pour la plupart des biblioth√®ques.\n                      </div>\n                    </div>\n                    <div class=\"col-md-4\">\n                      <div class=\"text-center\">\n                        <div class=\"bg-light p-3 rounded mb-3\">\n                          <i class=\"fas fa-microchip fa-4x text-primary mb-2\"></i>\n                          <p><strong>Raspberry Pi</strong></p>\n                        </div>\n                        <div class=\"bg-light p-3 rounded mb-3\">\n                          <i class=\"fas fa-wifi fa-4x text-success mb-2\"></i>\n                          <p><strong>Lecteur RFID</strong></p>\n                        </div>\n                        <div class=\"bg-light p-3 rounded\">\n                          <i class=\"fas fa-tags fa-4x text-warning mb-2\"></i>\n                          <p><strong>Puces RFID</strong></p>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                  \n                  <div class=\"mt-4\">\n                    <h6>üöÄ √âtapes d'Installation (Optionnel)</h6>\n                    <div class=\"row\">\n                      <div class=\"col-md-3\">\n                        <div class=\"text-center p-3 border rounded\">\n                          <div class=\"badge bg-primary rounded-pill mb-2\">1</div>\n                          <p><strong>Achat</strong><br>Commander le mat√©riel</p>\n                        </div>\n                      </div>\n                      <div class=\"col-md-3\">\n                        <div class=\"text-center p-3 border rounded\">\n                          <div class=\"badge bg-primary rounded-pill mb-2\">2</div>\n                          <p><strong>Montage</strong><br>Connecter le lecteur RFID</p>\n                        </div>\n                      </div>\n                      <div class=\"col-md-3\">\n                        <div class=\"text-center p-3 border rounded\">\n                          <div class=\"badge bg-primary rounded-pill mb-2\">3</div>\n                          <p><strong>Installation</strong><br>Script Python fourni</p>\n                        </div>\n                      </div>\n                      <div class=\"col-md-3\">\n                        <div class=\"text-center p-3 border rounded\">\n                          <div class=\"badge bg-success rounded-pill mb-2\">4</div>\n                          <p><strong>Activation</strong><br>Inventaire automatique</p>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                  \n                  <div class=\"text-center mt-4\">\n                    <button class=\"btn btn-outline-primary me-2\" (click)=\"simulateIoTSetup()\">\n                      <i class=\"fas fa-play\"></i> Simuler Installation IoT\n                    </button>\n                    <button class=\"btn btn-outline-secondary\" disabled>\n                      <i class=\"fas fa-download\"></i> T√©l√©charger Guide Complet\n                    </button>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <!-- Retards & P√©nalit√©s -->\n        <div *ngIf=\"activeTab === 'overdue'\" class=\"content-body\">\n          <div class=\"row mb-4\">\n            <div class=\"col-md-6\">\n              <button class=\"btn\" [class]=\"penaltyView === 'current' ? 'btn-primary' : 'btn-outline-primary'\" (click)=\"penaltyView = 'current'\">Retards actuels</button>\n            </div>\n            <div class=\"col-md-6\">\n              <button class=\"btn\" [class]=\"penaltyView === 'history' ? 'btn-primary' : 'btn-outline-primary'\" (click)=\"penaltyView = 'history'\">Historique p√©nalit√©s</button>\n            </div>\n          </div>\n          \n          <!-- Retards actuels -->\n          <div *ngIf=\"penaltyView === 'current'\" class=\"table-responsive\">\n            <table class=\"table table-hover\">\n              <thead>\n                <tr>\n                  <th>Utilisateur</th>\n                  <th>Livre</th>\n                  <th>Date pr√©vue</th>\n                  <th>Jours de retard</th>\n                  <th>Montant p√©nalit√©</th>\n                  <th>Actions</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr *ngFor=\"let overdue of overdueBorrows\">\n                  <td>{{overdue.user_name}}</td>\n                  <td>{{overdue.book_title}}</td>\n                  <td>{{overdue.due_date | date}}</td>\n                  <td class=\"text-danger\">{{overdue.days_overdue}}</td>\n                  <td>{{overdue.penalty_amount}} CFA</td>\n                  <td>\n                    <button class=\"btn btn-sm btn-outline-warning me-1\" (click)=\"applyPenalty(overdue)\" title=\"Appliquer p√©nalit√©\">\n                      <i class=\"fas fa-coins\"></i>\n                    </button>\n                    <button class=\"btn btn-sm btn-outline-primary me-1\" (click)=\"sendReminder(overdue.user_id)\" title=\"Envoyer relance\">\n                      <i class=\"fas fa-envelope\"></i>\n                    </button>\n                    <button class=\"btn btn-sm btn-outline-danger\" (click)=\"blacklistUser(overdue.user_id)\" title=\"Liste noire\">\n                      <i class=\"fas fa-ban\"></i>\n                    </button>\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n          \n          <!-- Historique p√©nalit√©s -->\n          <div *ngIf=\"penaltyView === 'history'\" class=\"table-responsive\">\n            <table class=\"table table-hover\">\n              <thead>\n                <tr>\n                  <th>Date</th>\n                  <th>Utilisateur</th>\n                  <th>Livre</th>\n                  <th>Montant</th>\n                  <th>Appliqu√© par</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr *ngFor=\"let penalty of penaltyHistory\">\n                  <td>{{penalty.applied_date | date:'short'}}</td>\n                  <td>{{penalty.user_name}}</td>\n                  <td>{{penalty.book_title}}</td>\n                  <td class=\"text-danger\">{{penalty.amount}} CFA</td>\n                  <td>{{penalty.admin_name}}</td>\n                </tr>\n              </tbody>\n            </table>\n            <div *ngIf=\"penaltyHistory.length === 0\" class=\"text-center py-4\">\n              <p class=\"text-muted\">Aucune p√©nalit√© appliqu√©e pour le moment</p>\n            </div>\n          </div>\n        </div>\n\n        <!-- Demandes / Inscriptions -->\n        <div *ngIf=\"activeTab === 'requests'\" class=\"content-body\">\n          <div class=\"table-responsive\">\n            <table class=\"table table-hover\">\n              <thead>\n                <tr>\n                  <th>Nom</th>\n                  <th>Email</th>\n                  <th>Date demande</th>\n                  <th>Documents</th>\n                  <th>Statut</th>\n                  <th>Actions</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr *ngFor=\"let request of registrationRequests\">\n                  <td>{{request.name}} {{request.surname}}</td>\n                  <td>{{request.email}}</td>\n                  <td>{{request.created_at | date}}</td>\n                  <td>\n                    <span class=\"badge bg-success\" *ngIf=\"request.documents_uploaded\">Upload√©s</span>\n                    <span class=\"badge bg-warning\" *ngIf=\"!request.documents_uploaded && !request.requested_document\">Manquants</span>\n                    <span class=\"badge bg-danger\" *ngIf=\"!request.documents_uploaded && request.requested_document\" \n                          [title]=\"'Document demand√©: ' + request.requested_document\">\n                      En attente: {{request.requested_document}}\n                    </span>\n                  </td>\n                  <td>\n                    <span class=\"badge bg-warning\">En attente</span>\n                  </td>\n                  <td>\n                    <button class=\"btn btn-sm btn-outline-primary me-1\" (click)=\"viewRequestProfile(request)\" title=\"Voir profil complet\">\n                      <i class=\"fas fa-eye\"></i>\n                    </button>\n                    <button class=\"btn btn-sm btn-outline-success me-1\" (click)=\"approveRequest(request.id)\" title=\"Valider\">\n                      <i class=\"fas fa-check\"></i>\n                    </button>\n                    <button class=\"btn btn-sm btn-outline-danger me-1\" (click)=\"rejectRequest(request.id)\" title=\"Refuser\">\n                      <i class=\"fas fa-times\"></i>\n                    </button>\n                    <button class=\"btn btn-sm btn-outline-info\" (click)=\"requestDocument(request.id)\" \n                            [title]=\"request.requested_document ? 'Redemander un document' : 'Demander justificatif'\">\n                      <i class=\"fas fa-file-alt\"></i>\n                      <span *ngIf=\"request.requested_document\" class=\"badge bg-danger ms-1\">!</span>\n                    </button>\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n\n        <!-- Statistiques & Rapports -->\n        <div *ngIf=\"activeTab === 'reports'\" class=\"content-body\">\n          <div class=\"row mb-4\">\n            <div class=\"col-md-4\">\n              <div class=\"card\">\n                <div class=\"card-header\">\n                  <h5><i class=\"fas fa-file-pdf\"></i> Rapports PDF</h5>\n                </div>\n                <div class=\"card-body\">\n                  <button class=\"btn btn-outline-danger w-100 mb-2\" (click)=\"exportReport('top-books')\">\n                    <i class=\"fas fa-trophy\"></i> Top Livres Populaires\n                  </button>\n                  <button class=\"btn btn-outline-success w-100 mb-2\" (click)=\"exportReport('monthly-activity')\">\n                    <i class=\"fas fa-calendar-alt\"></i> Activit√© Mensuelle\n                  </button>\n                  <button class=\"btn btn-outline-info w-100 mb-2\" (click)=\"exportReport('active-users')\">\n                    <i class=\"fas fa-users\"></i> Utilisateurs Actifs\n                  </button>\n                  <button class=\"btn btn-outline-warning w-100\" (click)=\"exportReport('iot-stats')\">\n                    <i class=\"fas fa-microchip\"></i> Statistiques IoT\n                  </button>\n                </div>\n              </div>\n            </div>\n            <div class=\"col-md-8\">\n              <div class=\"card\">\n                <div class=\"card-header\">\n                  <h5><i class=\"fas fa-chart-line\"></i> Graphiques d'Activit√©</h5>\n                </div>\n                <div class=\"card-body\">\n                  <div class=\"row\">\n                    <div class=\"col-md-6\">\n                      <canvas id=\"borrowsChart\" width=\"300\" height=\"200\"></canvas>\n                      <p class=\"text-center mt-2\"><strong>Emprunts par Mois</strong></p>\n                    </div>\n                    <div class=\"col-md-6\">\n                      <canvas id=\"categoriesChart\" width=\"300\" height=\"200\"></canvas>\n                      <p class=\"text-center mt-2\"><strong>Livres par Cat√©gorie</strong></p>\n                    </div>\n                  </div>\n                  <div class=\"row mt-4\">\n                    <div class=\"col-md-6\">\n                      <canvas id=\"usersChart\" width=\"300\" height=\"200\"></canvas>\n                      <p class=\"text-center mt-2\"><strong>Utilisateurs Actifs</strong></p>\n                    </div>\n                    <div class=\"col-md-6\">\n                      <canvas id=\"trendsChart\" width=\"300\" height=\"200\"></canvas>\n                      <p class=\"text-center mt-2\"><strong>Tendances</strong></p>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <!-- Configuration -->\n        <div *ngIf=\"activeTab === 'settings'\" class=\"content-body\">\n          <div class=\"row\">\n            <div class=\"col-md-6\">\n              <div class=\"card\">\n                <div class=\"card-header\">\n                  <h5>Param√®tres syst√®me</h5>\n                </div>\n                <div class=\"card-body\">\n                  <div class=\"mb-3\">\n                    <label class=\"form-label\">Dur√©e d'emprunt par d√©faut (jours)</label>\n                    <input type=\"number\" class=\"form-control\" [(ngModel)]=\"settings.default_borrow_days\" min=\"1\">\n                  </div>\n                  <div class=\"mb-3\">\n                    <label class=\"form-label\">P√©nalit√© par jour (CFA)</label>\n                    <input type=\"number\" class=\"form-control\" [(ngModel)]=\"settings.penalty_per_day\" min=\"0\">\n                  </div>\n                  <button class=\"btn btn-success\" (click)=\"saveSystemSettings()\">Sauvegarder</button>\n                </div>\n              </div>\n            </div>\n            <div class=\"col-md-6\">\n              <div class=\"card\">\n                <div class=\"card-header\">\n                  <h5>Param√®tres IoT</h5>\n                </div>\n                <div class=\"card-body\">\n                  <div class=\"mb-3\">\n                    <label class=\"form-label\">MQTT Broker</label>\n                    <input type=\"text\" class=\"form-control\" [(ngModel)]=\"settings.mqtt_broker\" placeholder=\"localhost:1883\">\n                  </div>\n                  <div class=\"mb-3\">\n                    <label class=\"form-label\">Topic RFID</label>\n                    <input type=\"text\" class=\"form-control\" [(ngModel)]=\"settings.rfid_topic\" placeholder=\"library/rfid\">\n                  </div>\n                  <button class=\"btn btn-success\" (click)=\"saveIoTSettings()\">Sauvegarder</button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <!-- Logs / Audit -->\n        <div *ngIf=\"activeTab === 'logs'\" class=\"content-body\">\n          <div class=\"d-flex justify-content-between align-items-center mb-4\">\n            <div class=\"search-filters\">\n              <input type=\"text\" class=\"form-control\" placeholder=\"Recherche dans les logs...\" [(ngModel)]=\"logSearch\" (input)=\"filterLogs()\">\n              <select class=\"form-select ms-2\" [(ngModel)]=\"logTypeFilter\" (change)=\"filterLogs()\">\n                <option value=\"\">Tous types</option>\n                <option value=\"admin\">Actions admin</option>\n                <option value=\"user\">Actions utilisateur</option>\n                <option value=\"system\">Syst√®me</option>\n              </select>\n            </div>\n            <button class=\"btn btn-outline-secondary\" (click)=\"exportLogs()\">Export logs</button>\n          </div>\n\n          <div *ngIf=\"filteredLogs.length === 0\" class=\"text-center py-5\">\n            <i class=\"fas fa-file-alt fa-3x text-muted mb-3\"></i>\n            <p class=\"text-muted\">Aucune activit√© enregistr√©e</p>\n            <small>Les logs apparaissent quand vous ajoutez des livres, utilisateurs ou emprunts</small>\n          </div>\n\n          <div *ngIf=\"filteredLogs.length > 0\" class=\"table-responsive\">\n            <table class=\"table table-hover\">\n              <thead>\n                <tr>\n                  <th>Date/Heure</th>\n                  <th>Type</th>\n                  <th>Utilisateur</th>\n                  <th>Action</th>\n                  <th>D√©tails</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr *ngFor=\"let log of filteredLogs\">\n                  <td>{{log.created_at | date:'dd/MM/yyyy HH:mm'}}</td>\n                  <td><span class=\"badge\" [class]=\"getLogTypeClass(log.type)\">{{log.type}}</span></td>\n                  <td>{{log.user_name || 'Syst√®me'}}</td>\n                  <td>{{log.action}}</td>\n                  <td>{{log.details}}</td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </div>\n    </div>\n  `,\n  styles: [`\n    .admin-layout {\n      display: flex;\n      min-height: 100vh;\n    }\n    .sidebar {\n      width: 280px;\n      background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);\n      border-right: 1px solid #dee2e6;\n      display: flex;\n      flex-direction: column;\n    }\n    .sidebar-header {\n      padding: 1.5rem;\n      border-bottom: 1px solid #dee2e6;\n      background: white;\n    }\n    .sidebar-header h4 {\n      margin: 0;\n      color: #495057;\n    }\n    .sidebar-nav {\n      flex: 1;\n      padding: 1rem 0;\n    }\n    .nav-item {\n      display: block;\n      padding: 0.75rem 1.5rem;\n      color: #6c757d;\n      text-decoration: none;\n      transition: all 0.2s;\n      cursor: pointer;\n    }\n    .nav-item:hover {\n      background: rgba(0,123,255,0.1);\n      color: #007bff;\n    }\n    .nav-item.active {\n      background: #007bff;\n      color: white;\n      border-right: 3px solid #0056b3;\n    }\n    .nav-item i {\n      width: 20px;\n      margin-right: 10px;\n    }\n    .nav-badge {\n      background: #007bff;\n      color: white;\n      border-radius: 50%;\n      padding: 2px 6px;\n      font-size: 0.7rem;\n      margin-left: 8px;\n      min-width: 18px;\n      text-align: center;\n    }\n    .nav-badge.bg-danger {\n      background: #dc3545 !important;\n    }\n    .sidebar-footer {\n      padding: 1rem;\n      border-top: 1px solid #dee2e6;\n    }\n    .main-content {\n      flex: 1;\n      display: flex;\n      flex-direction: column;\n    }\n    .content-header {\n      background: white;\n      padding: 1.5rem 2rem;\n      border-bottom: 1px solid #dee2e6;\n    }\n    .content-header h3 {\n      margin: 0;\n      color: #495057;\n    }\n    .breadcrumb {\n      color: #6c757d;\n      font-size: 0.875rem;\n      margin-top: 0.5rem;\n    }\n    .breadcrumb i {\n      margin: 0 0.5rem;\n      font-size: 0.75rem;\n    }\n    .content-body {\n      flex: 1;\n      padding: 2rem;\n      background: #f8f9fa;\n    }\n    .search-filters {\n      display: flex;\n      gap: 0.5rem;\n    }\n    .search-filters .form-control,\n    .search-filters .form-select {\n      min-width: 200px;\n    }\n    .book-cover {\n      border-radius: 4px;\n      object-fit: cover;\n    }\n    .book-cover-preview {\n      border-radius: 8px;\n      object-fit: cover;\n      border: 2px solid #dee2e6;\n      box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n    }\n    .device-item {\n      padding: 0.75rem;\n      border-bottom: 1px solid #dee2e6;\n    }\n    .device-item:last-child {\n      border-bottom: none;\n    }\n    .user-photo {\n      width: 32px;\n      height: 32px;\n      border-radius: 50%;\n      object-fit: cover;\n      border: 1px solid #dee2e6;\n    }\n    .logo-container {\n      display: flex;\n      justify-content: center;\n    }\n    .admin-logo {\n      width: 40px;\n      height: 40px;\n      position: relative;\n      margin: 0 auto;\n    }\n    .mini-wifi {\n      width: 20px;\n      height: 6px;\n      background: #2E8B8B;\n      border-radius: 10px 10px 0 0;\n      margin: 0 auto 2px;\n    }\n    .mini-book {\n      width: 30px;\n      height: 25px;\n      background: #1B365D;\n      border-radius: 4px;\n      margin: 0 auto;\n      position: relative;\n    }\n    .mini-book::after {\n      content: '';\n      position: absolute;\n      top: 4px;\n      left: 4px;\n      right: 4px;\n      height: 17px;\n      background: white;\n      border-radius: 2px;\n    }\n    @media (max-width: 768px) {\n      .admin-layout {\n        flex-direction: column;\n      }\n      .sidebar {\n        width: 100%;\n        height: auto;\n      }\n      .sidebar-nav {\n        display: flex;\n        overflow-x: auto;\n        padding: 0.5rem;\n      }\n      .nav-item {\n        white-space: nowrap;\n        min-width: 150px;\n      }\n    }\n  `]\n})], AdminDashboardComponent);\nexport { AdminDashboardComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}